<link rel="stylesheet" type="text/css" href="../css/blog.css"><div class="cloud-blog-detail-content-wrap the_height"><div class="cloud-blog-detail-content-wrap">
    <div class="cloud-blog-detail-content blog-content-block-0" id="blogContent">
        <p>项目原来是基于一个挺老的项目基础做的迭代二次开发，原来使用的是庖丁分词，这个分词库已经很久没人更新了，而且和高版本的lucene也有兼容问题,所以处理同义词问题之前，我把原来使用的padding中文分词替换成word中文分词;</p><p><br></p><p>同义词处理逻辑实际代码主要参考的这两个帖子:</p><p><a rel="nofollow" href="https://blog.csdn.net/yax405/article/details/43246237">https://blog.csdn.net/yax405/article/details/43246237</a></p><p><a rel="nofollow" href="https://blog.csdn.net/winnerspring/article/details/37567739">https://blog.csdn.net/winnerspring/article/details/37567739</a></p><p>部分代码如下:</p><pre class="brush:java;toolbar:false">package&nbsp;org.apdplat.word.lucene;
import&nbsp;java.io.IOException;
import&nbsp;java.nio.file.Paths;
import&nbsp;java.util.HashMap;
import&nbsp;java.util.Map;
import&nbsp;org.apache.lucene.analysis.Analyzer;
import&nbsp;org.apache.lucene.analysis.Analyzer.TokenStreamComponents;
import&nbsp;org.apache.lucene.analysis.TokenStream;
import&nbsp;org.apache.lucene.analysis.Tokenizer;
import&nbsp;org.apache.lucene.analysis.core.LowerCaseFilterFactory;
import&nbsp;org.apache.lucene.analysis.synonym.SynonymFilterFactory;
import&nbsp;org.apache.lucene.analysis.util.FilesystemResourceLoader;
import&nbsp;org.apache.lucene.util.Version;
import&nbsp;org.apdplat.word.segmentation.Segmentation;
import&nbsp;org.apdplat.word.segmentation.SegmentationAlgorithm;
import&nbsp;org.apdplat.word.segmentation.SegmentationFactory;
import&nbsp;org.slf4j.Logger;
import&nbsp;org.slf4j.LoggerFactory;
public&nbsp;class&nbsp;SynonymsAnalyzer
&nbsp;&nbsp;extends&nbsp;Analyzer
{
&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Logger&nbsp;LOGGER&nbsp;=&nbsp;LoggerFactory.getLogger(ChineseWordAnalyzer.class);
&nbsp;&nbsp;private&nbsp;Segmentation&nbsp;segmentation&nbsp;=&nbsp;null;
&nbsp;&nbsp;
&nbsp;&nbsp;public&nbsp;SynonymsAnalyzer()
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;this.segmentation&nbsp;=&nbsp;SegmentationFactory.getSegmentation(SegmentationAlgorithm.BidirectionalMinimumMatching);
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;public&nbsp;SynonymsAnalyzer(String&nbsp;segmentationAlgorithm)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;try
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SegmentationAlgorithm&nbsp;sa&nbsp;=&nbsp;SegmentationAlgorithm.valueOf(segmentationAlgorithm);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.segmentation&nbsp;=&nbsp;SegmentationFactory.getSegmentation(sa);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Exception&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.segmentation&nbsp;=&nbsp;SegmentationFactory.getSegmentation(SegmentationAlgorithm.BidirectionalMinimumMatching);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;public&nbsp;SynonymsAnalyzer(SegmentationAlgorithm&nbsp;segmentationAlgorithm)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;this.segmentation&nbsp;=&nbsp;SegmentationFactory.getSegmentation(segmentationAlgorithm);
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;public&nbsp;SynonymsAnalyzer(Segmentation&nbsp;segmentation)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;this.segmentation&nbsp;=&nbsp;segmentation;
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;private&nbsp;static&nbsp;SynonymFilterFactory&nbsp;factory&nbsp;=&nbsp;null;
&nbsp;&nbsp;
&nbsp;&nbsp;protected&nbsp;static&nbsp;SynonymFilterFactory&nbsp;getSynonymsFactory()
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(factory&nbsp;==&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;paramsMap&nbsp;=&nbsp;new&nbsp;HashMap();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version&nbsp;ver&nbsp;=&nbsp;Version.LUCENE_5_5_1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paramsMap.put("luceneMatchVersion",&nbsp;ver.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paramsMap.put("synonyms",&nbsp;"./synonyms.txt");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paramsMap.put("expand",&nbsp;"true");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory&nbsp;=&nbsp;new&nbsp;SynonymFilterFactory(paramsMap);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilesystemResourceLoader&nbsp;loader&nbsp;=&nbsp;new&nbsp;FilesystemResourceLoader(Paths.get("D:/RobotK/tomcat/synonyms",&nbsp;new&nbsp;String[0]));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.inform(loader);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(IOException&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;factory;
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;reloadSynonymFilterFactory()
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;paramsMap&nbsp;=&nbsp;new&nbsp;HashMap();
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Version&nbsp;ver&nbsp;=&nbsp;Version.LUCENE_5_5_1;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;paramsMap.put("luceneMatchVersion",&nbsp;ver.toString());
&nbsp;&nbsp;&nbsp;&nbsp;paramsMap.put("synonyms",&nbsp;"./synonyms.txt");
&nbsp;&nbsp;&nbsp;&nbsp;paramsMap.put("expand",&nbsp;"true");
&nbsp;&nbsp;&nbsp;&nbsp;factory&nbsp;=&nbsp;new&nbsp;SynonymFilterFactory(paramsMap);
&nbsp;&nbsp;&nbsp;&nbsp;try
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilesystemResourceLoader&nbsp;loader&nbsp;=&nbsp;new&nbsp;FilesystemResourceLoader(Paths.get("D:/RobotK/tomcat/synonyms",&nbsp;new&nbsp;String[0]));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.inform(loader);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(IOException&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;private&nbsp;static&nbsp;LowerCaseFilterFactory&nbsp;caseFactory&nbsp;=&nbsp;null;
&nbsp;&nbsp;
&nbsp;&nbsp;public&nbsp;static&nbsp;LowerCaseFilterFactory&nbsp;getCaseFilterFactory()
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(caseFactory&nbsp;==&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version&nbsp;ver&nbsp;=&nbsp;Version.LUCENE_5_5_1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,&nbsp;String&gt;&nbsp;filterArgs&nbsp;=&nbsp;new&nbsp;HashMap();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterArgs.put("luceneMatchVersion",&nbsp;ver.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caseFactory&nbsp;=&nbsp;new&nbsp;LowerCaseFilterFactory(filterArgs);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;caseFactory;
&nbsp;&nbsp;}
&nbsp;&nbsp;
&nbsp;&nbsp;protected&nbsp;Analyzer.TokenStreamComponents&nbsp;createComponents(String&nbsp;fieldName)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;Tokenizer&nbsp;tokenizer&nbsp;=&nbsp;new&nbsp;ChineseWordTokenizer(this.segmentation);
&nbsp;&nbsp;&nbsp;&nbsp;TokenStream&nbsp;casefilter&nbsp;=&nbsp;getCaseFilterFactory().create(tokenizer);
&nbsp;&nbsp;&nbsp;&nbsp;TokenStream&nbsp;filter&nbsp;=&nbsp;getSynonymsFactory().create(casefilter);
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Analyzer.TokenStreamComponents(tokenizer,&nbsp;filter);
&nbsp;&nbsp;}
}</pre><p>其他参考的帖子有:</p><p><a rel="nofollow" href="https://blog.csdn.net/u011066470/article/details/60963439">https://blog.csdn.net/u011066470/article/details/60963439</a></p><p><a rel="nofollow" href="http://www.hankcs.com/program/java/lucene-synonymfilterfactory.html">http://www.hankcs.com/program/java/lucene-synonymfilterfactory.html</a></p><p><a rel="nofollow" href="https://blog.csdn.net/yax405/article/details/43246237">https://blog.csdn.net/yax405/article/details/43246237</a></p><p><a rel="nofollow" href="https://blog.csdn.net/liyantianmin/article/details/59485799">https://blog.csdn.net/liyantianmin/article/details/59485799</a></p><p><a rel="nofollow" href="https://github.com/ysc/word/blob/master/src/main/java/org/apdplat/word/lucene/ChineseWordAnalyzer.java">https://github.com/ysc/word/blob/master/src/main/java/org/apdplat/word/lucene/ChineseWordAnalyzer.java</a></p><p><a rel="nofollow" href="https://blog.csdn.net/winnerspring/article/details/37567739">https://blog.csdn.net/winnerspring/article/details/37567739</a></p><p><a rel="nofollow" href="https://my.oschina.net/apdplat/blog/228619">https://my.oschina.net/apdplat/blog/228619</a></p><p><br></p><p><a rel="nofollow" href="http://www.hankcs.com/program/java/lucene-synonymfilterfactory.html">http://www.hankcs.com/program/java/lucene-synonymfilterfactory.html</a></p><p style="margin-top:0px;margin-bottom:18px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;font-size:15px;white-space:normal;background-color:rgb(255,255,255);text-indent:2em;">在Lucene4.6中通过SynonymFilterFactory实现中文同义词非常方便，只需几行代码和一个同义词词典。这个词典还能在Lucene中实现一定程度的拼写纠错，提升搜索体验。在下面这个例子中我们从磁盘载入一个同义词词典，并且对“其实hankcs似好人”这句话进行stream化以供索引，同时还对其中的拼写错误“似-&gt;是”做出纠正。</p><h2 style="font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;line-height:1.1;color:rgb(85,85,85);margin:18px 0px;font-size:18px;padding:10px 0px;border-bottom:1px solid rgb(234,234,234);white-space:normal;background-color:rgb(255,255,255);">首先是位于./data/synonyms.txt路径下的同义词词典：</h2><pre class="brush:plain;toolbar:false prettyprint linenums" style="overflow:hidden;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:10px 15px;margin-top:20px;margin-bottom:20px;line-height:1.42857;color:rgb(248,248,212);background-color:rgb(39,40,34);border:none;">我,俺,hankcs似,is,are&nbsp;=&gt;&nbsp;是好人,好心人,热心人</pre><p style="margin-top:0px;margin-bottom:18px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;font-size:15px;white-space:normal;background-color:rgb(255,255,255);text-indent:2em;">可以看出上面有两种词典格式：</p><h3 style="font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;line-height:1.1;color:rgb(85,85,85);margin-top:20px;margin-bottom:18px;font-size:16px;padding:10px 0px;white-space:normal;background-color:rgb(255,255,255);">通过,分割的可拓展同义词</h3><p style="margin-top:0px;margin-bottom:18px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;font-size:15px;white-space:normal;background-color:rgb(255,255,255);text-indent:2em;">比如“我,俺,hankcs”代表着这三个词是同义词，并且任何一个词可以被expand（拓展）为其他三个。如果expand设为false的话，则这三个词都会被统一替换为第一个词，也就是“我”。</p><h3 style="font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;line-height:1.1;color:rgb(85,85,85);margin-top:20px;margin-bottom:18px;font-size:16px;padding:10px 0px;white-space:normal;background-color:rgb(255,255,255);">通过=&gt;收缩的不可拓展同义词</h3><p style="margin-top:0px;margin-bottom:18px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;font-size:15px;white-space:normal;background-color:rgb(255,255,255);text-indent:2em;">比如“似,is,are&nbsp;=&gt;&nbsp;是”代表这三个词同义，并且无视expand参数，统一会被替换为“是”</p><h2 style="font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;line-height:1.1;color:rgb(85,85,85);margin:18px 0px;font-size:18px;padding:10px 0px;border-bottom:1px solid rgb(234,234,234);white-space:normal;background-color:rgb(255,255,255);">然后是加载代码</h2><pre style="list-style:inherit;overflow:auto;font-size:14px;line-height:1.45;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;margin-top:0px;margin-bottom:30px;padding:16px 24px;background-color:rgb(244,244,244);border:1px solid rgb(232,232,232);color:rgb(102,102,102);">package&nbsp;com.hankcs.test;
import&nbsp;org.apache.lucene.analysis.TokenStream;
import&nbsp;org.apache.lucene.analysis.core.WhitespaceAnalyzer;
import&nbsp;org.apache.lucene.analysis.synonym.SynonymFilterFactory;
import&nbsp;org.apache.lucene.analysis.tokenattributes.CharTermAttribute;
import&nbsp;org.apache.lucene.analysis.tokenattributes.OffsetAttribute;
import&nbsp;org.apache.lucene.analysis.util.FilesystemResourceLoader;
import&nbsp;org.apache.lucene.util.Version;
import&nbsp;org.apache.uima.annotator.WhitespaceTokenizer;&nbsp;
import&nbsp;java.io.IOException;import&nbsp;java.io.StringReader;
import&nbsp;java.util.HashMap;import&nbsp;java.util.Map;&nbsp;
/**&nbsp;*&nbsp;@author&nbsp;hankcs&nbsp;*/
public&nbsp;class&nbsp;TestSynonyms{&nbsp;&nbsp;&nbsp;&nbsp;
private&nbsp;static&nbsp;void&nbsp;displayTokens(TokenStream&nbsp;ts)&nbsp;throws&nbsp;IOException&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CharTermAttribute&nbsp;termAttr&nbsp;=&nbsp;ts.addAttribute(CharTermAttribute.class);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OffsetAttribute&nbsp;offsetAttribute&nbsp;=&nbsp;ts.addAttribute(OffsetAttribute.class);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ts.reset();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(ts.incrementToken())&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;token&nbsp;=&nbsp;termAttr.toString();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(offsetAttribute.startOffset()&nbsp;+&nbsp;"-"&nbsp;+&nbsp;offsetAttribute.endOffset()&nbsp;+&nbsp;"["&nbsp;+&nbsp;token&nbsp;+&nbsp;"]&nbsp;");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ts.end();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ts.close();&nbsp;&nbsp;&nbsp;&nbsp;
}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
String&nbsp;testInput&nbsp;=&nbsp;"其实&nbsp;hankcs&nbsp;似&nbsp;好人";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Version&nbsp;ver&nbsp;=&nbsp;Version.LUCENE_46;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Map&lt;String,&nbsp;String&gt;&nbsp;filterArgs&nbsp;=&nbsp;new&nbsp;HashMap&lt;String,&nbsp;String&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
filterArgs.put("luceneMatchVersion",&nbsp;ver.toString());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
filterArgs.put("synonyms",&nbsp;"./data/synonyms.txt");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
filterArgs.put("expand",&nbsp;"true");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SynonymFilterFactory&nbsp;factory&nbsp;=&nbsp;new&nbsp;SynonymFilterFactory(filterArgs);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
factory.inform(new&nbsp;FilesystemResourceLoader());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
WhitespaceAnalyzer&nbsp;whitespaceAnalyzer&nbsp;=&nbsp;new&nbsp;WhitespaceAnalyzer(ver);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TokenStream&nbsp;ts&nbsp;=&nbsp;factory.create(whitespaceAnalyzer.tokenStream("someField",&nbsp;testInput));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
displayTokens(ts);&nbsp;&nbsp;&nbsp;&nbsp;
}
}</pre><p style="margin-top:0px;margin-bottom:18px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;font-size:15px;white-space:normal;background-color:rgb(255,255,255);text-indent:2em;">输出：</p><p style="margin-top:0px;padding:0px;line-height:20px;text-indent:2em;">0-2[其实] 3-9[我] 3-9[俺] 3-9[hankcs] 10-11[是] 12-14[好人] 12-14[好心人] 12-14[热心人]</p><p style="margin-top:0px;margin-bottom:18px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, STXihei, '华文细黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Heiti, '黑体', sans-serif;font-size:15px;white-space:normal;background-color:rgb(255,255,255);text-indent:2em;">由于 我 俺 hankcs 三个词是同一个意思，所以它们被视为同一个term，并且它们的偏移相同，都是3-&gt;9，这个长度取决于原来的词 hankcs 的长度。</p><p><a rel="nofollow" href="https://blog.csdn.net/yax405/article/details/43246237">https://blog.csdn.net/yax405/article/details/43246237</a></p><p><a rel="nofollow" href="https://blog.csdn.net/u010366796/article/details/44937025">https://blog.csdn.net/u010366796/article/details/44937025</a></p><p><a rel="nofollow" href="http://www.voidcn.com/article/p-txqtdabn-bbo.html">http://www.voidcn.com/article/p-txqtdabn-bbo.html</a></p><p><a rel="nofollow" href="http://blog.csdn.net/winnerspring/article/details/37521101">http://blog.csdn.net/winnerspring/article/details/37521101</a></p><p><a rel="nofollow" href="http://www.voidcn.com/article/p-pjrzypvg-bbo.html">http://www.voidcn.com/article/p-pjrzypvg-bbo.html</a></p><p><a rel="nofollow" href="http://blog.csdn.net/winnerspring/article/details/37567739">http://blog.csdn.net/winnerspring/article/details/37567739</a></p><p><a rel="nofollow" href="http://blog.csdn.net/hu948162999/article/details/41283597">http://blog.csdn.net/hu948162999/article/details/41283597</a></p><p><a rel="nofollow" href="http://www.voidcn.com/article/p-xrordklc-bah.html">http://www.voidcn.com/article/p-xrordklc-bah.html</a></p><p><a rel="nofollow" href="https://iamyida.iteye.com/blog/2197355">https://iamyida.iteye.com/blog/2197355</a></p><p><a rel="nofollow" href="https://cloud.tencent.com/info/034aa996312ba4928c57ae831d6acedf.html">https://cloud.tencent.com/info/034aa996312ba4928c57ae831d6acedf.html</a></p><p>lucene 同义词的索引</p><pre style="list-style:inherit;overflow:auto;font-size:14px;line-height:1.45;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;margin-top:0px;margin-bottom:30px;padding:16px 24px;background-color:rgb(244,244,244);border:1px solid rgb(232,232,232);color:rgb(102,102,102);">public&nbsp;interface&nbsp;SynonymEngine&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;getSynonyms(String&nbsp;key);
}</pre><pre style="list-style:inherit;overflow:auto;font-size:14px;line-height:1.45;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;margin-top:0px;margin-bottom:30px;padding:16px 24px;background-color:rgb(244,244,244);border:1px solid rgb(232,232,232);color:rgb(102,102,102);">public&nbsp;class&nbsp;SynonymEngineImpl&nbsp;implements&nbsp;SynonymEngine&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;HashMap&lt;String,String[]&gt;&nbsp;map&nbsp;=&nbsp;new&nbsp;HashMap&lt;String&nbsp;,String[]&gt;();

&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put("quick",new&nbsp;String[]{"fast","speedy"});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put("jumps",new&nbsp;String[]{"leaps","hops"});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put("over",new&nbsp;String[]{"above"});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put("lazy",new&nbsp;String[]{"apathetic","sluggish"});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put("dog",new&nbsp;String[]{"canine","pooch"});
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String[]&nbsp;getSynonyms(String&nbsp;key)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Auto-generated&nbsp;method&nbsp;stub
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;map.get(key);
&nbsp;&nbsp;&nbsp;&nbsp;}

}</pre><pre style="list-style:inherit;overflow:auto;font-size:14px;line-height:1.45;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;margin-top:0px;margin-bottom:30px;padding:16px 24px;background-color:rgb(244,244,244);border:1px solid rgb(232,232,232);color:rgb(102,102,102);">public&nbsp;class&nbsp;SynonymFilter&nbsp;extends&nbsp;TokenFilter&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;SynonymEngine&nbsp;engine;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;CharTermAttribute&nbsp;ct;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;PositionIncrementAttribute&nbsp;pt;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Stack&lt;String&gt;&nbsp;stack;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AttributeSource.State&nbsp;current;
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;SynonymFilter(TokenStream&nbsp;input,SynonymEngine&nbsp;engine)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(input);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.engine&nbsp;=&nbsp;engine;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct&nbsp;=&nbsp;this.addAttribute(CharTermAttribute.class);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt&nbsp;=&nbsp;this.addAttribute(PositionIncrementAttribute.class);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stack&nbsp;&nbsp;=&nbsp;new&nbsp;Stack&lt;String&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;incrementToken()&nbsp;throws&nbsp;IOException&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(stack.size()&gt;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.restoreState(current);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;p&nbsp;=&nbsp;stack.pop();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct.setEmpty();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct.append(p);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.setPositionIncrement(0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("++++++"+ct);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!input.incrementToken())&nbsp;return&nbsp;false;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("------"+ct);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(addSynonym(ct.toString()))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;=&nbsp;this.captureState();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;boolean&nbsp;addSynonym(String&nbsp;name)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;sa&nbsp;=&nbsp;engine.getSynonyms(name);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sa&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;sa.length&gt;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(String&nbsp;s:sa)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stack.push(s);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}

}</pre><pre style="list-style:inherit;overflow:auto;font-size:14px;line-height:1.45;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;margin-top:0px;margin-bottom:30px;padding:16px 24px;background-color:rgb(244,244,244);border:1px solid rgb(232,232,232);color:rgb(102,102,102);">public&nbsp;class&nbsp;SynonymAnalyzer&nbsp;extends&nbsp;Analyzer&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;SynonymEngine&nbsp;engine;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;SynonymAnalyzer(SynonymEngine&nbsp;engine)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.engine&nbsp;=&nbsp;engine;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;TokenStream&nbsp;tokenStream(String&nbsp;s,&nbsp;Reader&nbsp;reader)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Auto-generated&nbsp;method&nbsp;stub
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;SynonymFilter(new&nbsp;StopFilter(Version.LUCENE_35,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;LowerCaseFilter(Version.LUCENE_35,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;StandardFilter(Version.LUCENE_35,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;StandardTokenizer(Version.LUCENE_35,reader)))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,StopAnalyzer.ENGLISH_STOP_WORDS_SET),engine);
&nbsp;&nbsp;&nbsp;&nbsp;}

}</pre><pre style="list-style:inherit;overflow:auto;font-size:14px;line-height:1.45;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;margin-top:0px;margin-bottom:30px;padding:16px 24px;background-color:rgb(244,244,244);border:1px solid rgb(232,232,232);color:rgb(102,102,102);">public&nbsp;class&nbsp;TestSynonym&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RAMDirectory&nbsp;directory;
&nbsp;&nbsp;&nbsp;&nbsp;@Test
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;init()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directory&nbsp;=&nbsp;new&nbsp;RAMDirectory();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SynonymEngine&nbsp;engine&nbsp;=&nbsp;new&nbsp;SynonymEngineImpl();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IndexWriterConfig&nbsp;config&nbsp;=&nbsp;new&nbsp;IndexWriterConfig(Version.LUCENE_35,new&nbsp;SynonymAnalyzer(engine));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;content&nbsp;=&nbsp;"The&nbsp;quick&nbsp;brown&nbsp;fox&nbsp;jumps&nbsp;over&nbsp;the&nbsp;lazy&nbsp;dog";
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IndexWriter&nbsp;writer&nbsp;=&nbsp;new&nbsp;IndexWriter(directory,config);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Document&nbsp;doc&nbsp;=&nbsp;new&nbsp;Document();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.add(new&nbsp;Field("content",content,Field.Store.YES,Field.Index.ANALYZED));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.addDocument(doc);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.close();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IndexReader&nbsp;reader&nbsp;=&nbsp;IndexReader.open(directory);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IndexSearcher&nbsp;searcher&nbsp;=&nbsp;new&nbsp;IndexSearcher(reader);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TopDocs&nbsp;docs&nbsp;=&nbsp;searcher.search(new&nbsp;TermQuery(new&nbsp;Term("content","pooch")),10);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(ScoreDoc&nbsp;sd:docs.scoreDocs)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Document&nbsp;d&nbsp;=&nbsp;searcher.doc(sd.doc);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(d.get("content"));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(CorruptIndexException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Auto-generated&nbsp;catch&nbsp;block
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(LockObtainFailedException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Auto-generated&nbsp;catch&nbsp;block
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Auto-generated&nbsp;catch&nbsp;block
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p><a rel="nofollow" href="http://www.itzk.com/b/1109/581983.shtml">http://www.itzk.com/b/1109/581983.shtml</a></p><h1 style="margin:0px 0px 6px;padding:0px;font-size:24px;line-height:30px;font-family:'宋体', arial;text-align:center;white-space:normal;">Lucene的同义词分析器讲解</h1><p><strong><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">这个分析器用SynonymFilter过滤器对StandardAnalyzer类进行封装,当向这个过滤器输入各个项时,会对这些项进行缓冲,并使用栈存储这些项的同义词[code]&nbsp;</span><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">public class SynonymFilter extends TokenFilter{&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">publicstatic final String TOKEN_TYPE_SYNONYM="SYNONYM";&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">privateStack synonymStack;&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">privateSynonynEngine engine;&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">publicSynonymFilter(TokenStream in,SynonymEngine engine){&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">super(in);&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">synonymStack=new Stack();//缓存同义词&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">this.engine=engine;&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">}&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">publicTOken next() throws IOException{&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">if (synonymStack.size()&gt;0){//如何还有当前词的同义词没有输出,则输出&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">return (Token) synonymStack.pop();&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">}&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">Token token=input.next();//读取新词&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">if (token==null) {&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">return null;&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">}&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">addAliasesToStack(token);//存储新词的同义词&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">returntoken;&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">}&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">private voidaddAliasesToStack(Token token) throws IOException{&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">String[] synonyms=engine.getSynonyms(token.termText());&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">if (synonyms==mull) return;&nbsp;</span><br><br><span style="color:rgb(68,68,68);font-family:Arial, Helvetica, sans-serif, '宋体';font-size:14px;">for (int i=0;i</span>&lt;synonyms.length;i++){ &nbsp;<br>Token synToken=newToken(synonyms[i],token.startOffset(),token.endOffset(),TOKEN_TYPE_SYNONYM);&nbsp;<br><br>synToken.setPositionIncrement(0);&nbsp;<br><br>synonymStack.push(synToken);&nbsp;<br><br>}&nbsp;<br><br>}[/code]以下这个接口是关键,可以自由实现,目的是返回s的同义词数组[code]public interface SynonymEngine{&nbsp;<br><br>String[] getSynonyms(String s) throws IOException;&nbsp;<br><br>}&nbsp;<br>[/code]对于这个接口要小心使用,在查询时不必列出所有的同义词,如下例[code]Query query=QueryParser.parse("\"foxjumps\"","content",synonymAnalyzer);&nbsp;<br><br>Hits hits=searcher.search(query);[/code]是会出错的,找不到任何结果,因为QueryParser不会区别位置增量,所以位置增量为0这一个表明同义的特征无法体现,会将"foxjumps"直接加上同义词解释为"fox jumps hops leaps"</strong><br></p><p><strong><a rel="nofollow" href="https://stackoverrun.com/cn/q/4705011">https://stackoverrun.com/cn/q/4705011</a> </strong></p><p style="margin-top:0px;color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);">我想弄清楚lucene的分析仪是如何工作的？ 我的问题是，lucene如何处理同义词？这里的情况是： 我们有一个词和多词</p><p style="margin-top:0px;color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);">单：富=酒吧 多的话：富巴= foobar的</p><p style="margin-top:0px;color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);">对于单个的词：</p><ul style="color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);" class="list-paddingleft-2"><li><p>是否Lucene的扩大索引记录或不？我猜如果一个查询有一个像“foo”这样的词，它也会在查询中添加“bar”。我不知道是否索引或不索引？</p></li></ul><p style="margin-top:0px;color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);">对于多话：</p><ul style="color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);" class="list-paddingleft-2"><li><p>是否Lucene的扩大查询和索引？例如，如果我们有“富吧”，它是否将foobar添加到索引/查询？</p></li></ul><p style="margin-top:0px;color:rgb(33,37,41);font-family:'-apple-system', BlinkMacSystemFont, 'segoe ui', Roboto, 'helvetica neue', Arial, sans-serif, 'apple color emoji', 'segoe ui emoji', 'segoe ui symbol';white-space:normal;background-color:rgb(255,255,255);">我的第二个问题是：Lucene使用一个标记流并将它们提供给小写过滤器之类的过滤器。我的问题是lucene如何找到多词？比如它是如何发现“foo bar”是一个多词的？</p><p style="margin-top:0px;"><a rel="nofollow" href="http://lucene.apache.org/core/4_0_0/analyzers-common/org/apache/lucene/analysis/synonym/SynonymFilter.html" style="background-color:transparent;color:rgb(0,119,204);">SynonymFilter</a>可任选，保持原有的单词，并添加同义词到的TokenStream中，通过设置<code class="prettyprint-override prettyprinted" style="font-size:14.4px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'liberation mono', 'courier new', monospace;color:inherit;background-color:rgb(248,249,250);padding:2px 4px;"><span class="pln" style="color:rgb(0,0,0);">keepOrig</span></code>&nbsp;=真（见<a rel="nofollow" href="http://lucene.apache.org/core/4_0_0/analyzers-common/org/apache/lucene/analysis/synonym/SynonymMap.Builder.html#add%28org.apache.lucene.util.CharsRef,%20org.apache.lucene.util.CharsRef,%20boolean%29" style="background-color:transparent;color:rgb(0,119,204);">SynonymMap.Builder.add()</a>）。此行为可能会导致PhraseQueries等问题，请参阅<code class="prettyprint-override prettyprinted" style="font-size:14.4px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'liberation mono', 'courier new', monospace;color:inherit;background-color:rgb(248,249,250);padding:2px 4px;"><span class="typ" style="color:rgb(102,0,102);">SynonymFilter</span></code>文档中的第<span style="font-weight:bolder;">注意事项</span>。</p><p style="margin-top:0px;">如果您使用相同的<code class="prettyprint-override prettyprinted" style="font-size:14.4px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'liberation mono', 'courier new', monospace;color:inherit;background-color:rgb(248,249,250);padding:2px 4px;"><span class="typ" style="color:rgb(102,0,102);">Analyzer</span></code>进行查询和编制索引，那么写入索引的查询和文档当然都会以同样的方式处理。&nbsp;<code class="prettyprint-override prettyprinted" style="font-size:14.4px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'liberation mono', 'courier new', monospace;color:inherit;background-color:rgb(248,249,250);padding:2px 4px;"><span class="typ" style="color:rgb(102,0,102);">SynonymFilter</span></code>与<code class="prettyprint-override prettyprinted" style="font-size:14.4px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'liberation mono', 'courier new', monospace;color:inherit;background-color:rgb(248,249,250);padding:2px 4px;"><span class="pln" style="color:rgb(0,0,0);">keepOrig</span></code>设置为true是少数几个<code class="prettyprint-override prettyprinted" style="font-size:14.4px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'liberation mono', 'courier new', monospace;color:inherit;background-color:rgb(248,249,250);padding:2px 4px;"><span class="typ" style="color:rgb(102,0,102);">Analyzers</span></code>之一，经常在查询和索引之间不合时宜地应用，但这完全取决于您的实现。</p><p style="margin-top:0px;">至于如何实施，<a rel="nofollow" href="http://grepcode.com/file/repo1.maven.org/maven2/org.apache.lucene/lucene-analyzers-common/4.0.0/org/apache/lucene/analysis/synonym/SynonymFilter.java" style="background-color:transparent;color:rgb(0,119,204);">source code</a>可供您使用。</p><p class="text-secondary col-lg-6 col-md-6 col-sm-6 col-xs-12" style="margin-top:0px;width:391.875px;padding-right:15px;padding-left:15px;color:rgb(108,117,125);"><small><a rel="nofollow" href="https://stackoverflow.com/q/17283519" style="background-color:transparent;color:rgb(136,136,136);">来源</a></small>&nbsp;<small><a rel="nofollow" class="share-url" href="https://stackoverrun.com/cn/q/4705011#17283519" style="background-color:transparent;color:rgb(136,136,136);">分享</a></small></p><p class="text-secondary createDate col-lg-6 col-md-6 col-sm-6 col-xs-12" style="margin-top:0px;width:391.875px;padding-right:15px;padding-left:15px;color:rgb(108,117,125);"><small>创建&nbsp;24 6月. 13&nbsp;<a rel="nofollow" href="https://stackoverflow.com/users/1628375/" style="background-color:transparent;color:rgb(136,136,136);">femtoRgon</a></small></p><p><span class="text-secondary" style="color:rgb(108,117,125);">&nbsp;&nbsp;0</span>&nbsp;<span class="exchange"><span class="fa fa-language" style="color:rgb(43,121,194);display:inline-block;line-height:1;font-family:FontAwesome;font-size:inherit;"></span></span></p><p class="commenttext" style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="post-text">它是如何处理多个同义词的？像“纽约”=“纽约” 沃尔玛=沃尔玛=沃尔玛 ，因为它通过令牌执行过滤令牌。我不知道它是如何找到多个单词的同义词</span>&nbsp;–&nbsp;<span class="text-secondary" style="color:rgb(108,117,125);"><small><a rel="nofollow" href="https://stackoverflow.com/users/2506210/" style="background-color:transparent;color:rgb(0,119,204);">Mr.Boy</a>&nbsp;24 6月. 13</small></span></p><p><span class="text-secondary" style="color:rgb(108,117,125);">&nbsp;&nbsp;0</span>&nbsp;<span class="exchange"><span class="fa fa-language" style="color:rgb(43,121,194);display:inline-block;line-height:1;font-family:FontAwesome;font-size:inherit;"></span></span></p><p class="commenttext" style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="post-text">有没有你对它的行为感到困惑，或者你想知道实现如何处理令牌流？如果是后者，那就是为什么我提供了链接到源代码的原因。如果前者贪婪地搜索最长匹配，它可以从给定的位置（也就是说，如果你有规则'foo' - &gt;'bar'，'foo bar' - &gt;'foobar'，那么'foo bar'会变成'foobar'，而不是'bar bar'）。我不相信它支持'wal mart = wal-mart = walmart'这样的东西（同义词规则有一个输入和一个输出）。如果有什么特别的要问的话，继续。</span>&nbsp;–&nbsp;<span class="text-secondary" style="color:rgb(108,117,125);"><small><a rel="nofollow" href="https://stackoverflow.com/users/1628375/" style="background-color:transparent;color:rgb(0,119,204);">femtoRgon</a>&nbsp;24 6月. 13</small></span></p><p><span class="text-secondary" style="color:rgb(108,117,125);">&nbsp;&nbsp;0</span>&nbsp;<span class="exchange"><span class="fa fa-language" style="color:rgb(43,121,194);display:inline-block;line-height:1;font-family:FontAwesome;font-size:inherit;"></span></span></p><p class="commenttext" style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="post-text">我的问题是它如何处理令牌流？因为我猜同义词过滤器一个接一个地得到令牌，而且它是无状态的。例如，如果当前令牌为“新”，它如何检查下一个令牌以查看它是否是“约克”？</span></p><p><br></p>
    </div>
    
    
    <p class="pc_current ask-tip">登录后可下载附件，请<a href="https://auth.huaweicloud.com/authui/login?service=https://bbs.huaweicloud.com/blogs/113065#attachment&amp;locale=zh-cn">登录</a>或者<a href="https://reg.huaweicloud.com/registerui/public/custom/register.html?locale=zh-cn&amp;service=https://bbs.huaweicloud.com#/register">注册</a></p>

    <!-- 版权声明 start -->
    
   
    
    <!-- 版权声明 end -->

    <div class="blog-menu-footer m-blog-menu-footer-bottom">
        
    </div>
</div></div>