<link rel="stylesheet" type="text/css" href="../css/blog.css"><div class="cloud-blog-detail-content-wrap the_height"><div class="cloud-blog-detail-content-wrap">
    <div class="cloud-blog-detail-content blog-content-block-0" id="blogContent">
        <h3>poi处理表格到现在还记得的一个问题是合并会出现假合并的现象，后来使用setCellType(CellType.BLANK)解决了这个问题</h3><h3>下面是poi3.17的poi使用 部分代码乱乱的 不过可以参考：</h3><p>import org.apache.poi.hssf.usermodel.HSSFCell;</p><p>import org.apache.poi.hssf.usermodel.HSSFCellStyle;</p><p>import org.apache.poi.hssf.usermodel.HSSFDataFormat;</p><p>import org.apache.poi.hssf.usermodel.HSSFFont;</p><p>import org.apache.poi.hssf.usermodel.HSSFRichTextString;</p><p>import org.apache.poi.hssf.usermodel.HSSFRow;</p><p>import org.apache.poi.hssf.usermodel.HSSFSheet;</p><p>import org.apache.poi.hssf.usermodel.HSSFWorkbook;</p><p>import org.apache.poi.hssf.util.HSSFColor;</p><p>import org.apache.poi.ss.usermodel.BorderStyle;</p><p>import org.apache.poi.ss.usermodel.CellType;</p><p>import org.apache.poi.ss.usermodel.CreationHelper;</p><p>import org.apache.poi.ss.usermodel.FillPatternType;</p><p>import org.apache.poi.ss.usermodel.HorizontalAlignment;</p><p>import org.apache.poi.ss.usermodel.VerticalAlignment;</p><p>import org.apache.poi.ss.util.CellRangeAddress;</p><p>import org.springframework.context.ApplicationContext;</p><p>public class ExportExcelUtils {</p><p>/**</p><p>&nbsp;* 创建一个excel文件</p><p>&nbsp;*/</p><p>private HSSFWorkbook wb = null;</p><p>/**</p><p>&nbsp;* 创建一个excel工作表</p><p>&nbsp;*/</p><p>private HSSFSheet sheet = null;</p><p>/**</p><p>&nbsp;* 无参构造函数</p><p>&nbsp;*/</p><p>public ExportExcelUtils() {</p><p>this(new HSSFWorkbook());</p><p>}</p><p>/**</p><p>&nbsp;* 一个参数的构造函数（ps:不存在只有sheet的构造函数，因为sheet是从wb中创建而来的）</p><p>&nbsp;* @param wb</p><p>&nbsp;*/</p><p>public ExportExcelUtils(HSSFWorkbook wb){</p><p>this(wb,wb.createSheet());</p><p>}</p><p>/**</p><p>&nbsp;* 双参构造函数</p><p>&nbsp;* @param wbexcel文件</p><p>&nbsp;* @param sheet工作表</p><p>&nbsp;*/</p><p>public ExportExcelUtils(HSSFWorkbook wb,HSSFSheet sheet){</p><p>this.wb = wb;</p><p>this.sheet = sheet;</p><p>}</p><p>/**</p><p>&nbsp;* @return wb</p><p>&nbsp;*/</p><p>public HSSFWorkbook getWb() {</p><p>return wb;</p><p>}</p><p>/**</p><p>&nbsp;* @param wbset wb to this.wb</p><p>&nbsp;*/</p><p>public void setWb(HSSFWorkbook wb) {</p><p>this.wb = wb;</p><p>}</p><p>/**</p><p>&nbsp;* @returnsheet</p><p>&nbsp;*/</p><p>public HSSFSheet getSheet() {</p><p>return sheet;</p><p>}</p><p>/**</p><p>&nbsp;* @param sheetset sheet to this.sheet</p><p>&nbsp;*/</p><p>public void setSheet(HSSFSheet sheet) {</p><p>this.sheet = sheet;</p><p>}</p><p>/**</p><p>&nbsp;* 创建通用excel头部</p><p>&nbsp;* @param headString头部显示的字符串</p><p>&nbsp;* @param colSum该报表列数</p><p>&nbsp;*/</p><p>public void createNormalHead(String headString,int colSum){</p><p>HSSFRow row = sheet.createRow(0);</p><p>//设置第一行</p><p>HSSFCell cell = row.createCell(0);</p><p>//合并第一行前colSum列</p><p>sheet.addMergedRegion(new CellRangeAddress(0,0,0,colSum - 1));</p><p>//CellRangeAddress类用来替代org.apache.poi.hssf.util.Region,sheet中使用Region的一系列方法都已过期。</p><p>//CellRangeAddress中四个参数的意思为，以参数为1,2,3,4为例:将从第0行到第1行,从第2列到第3列的单元格合并。</p><p>//定义单元格为字符串类型</p><p>//cell.setCellType(HSSFCell.ENCODING_UTF_16);//中文处理</p><p>cell.setCellValue(new HSSFRichTextString(headString));//设置单元格的值</p><p>//定义单元格格式，添加单元格表样式，并添加到工作簿</p><p>HSSFCellStyle cellStyle = wb.createCellStyle();</p><p>//设置单元格对齐类型</p><p>cellStyle.setAlignment(HorizontalAlignment.CENTER);//指定单元格水平居中对齐</p><p>cellStyle.setVerticalAlignment(VerticalAlignment.CENTER);//指定单元格垂直居中对齐</p><p>cellStyle.setWrapText(true);//指定单元格自动换行</p><p>cellStyle.setLeftBorderColor(HSSFColor.BLACK.index);//设置左边框颜色HSSFColorPredefined. .getIndex()</p><p>cellStyle.setBorderLeft(BorderStyle.valueOf((short)1));//设置左边框大小</p><p>cellStyle.setRightBorderColor(HSSFColor.BLACK.index);//设置右边框颜色</p><p>cellStyle.setBorderRight(BorderStyle.valueOf((short)1));//设置右边框大小</p><p>//设置单元格字体</p><p>HSSFFont font = wb.createFont();</p><p>//font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);//设置内容加粗</p><p>font.setBold(true);</p><p>font.setFontName("宋体");//设置字体</p><p>font.setFontHeight((short)600);//设置字体高度</p><p>//font.setFontHeightInPoints((short)10);//设置字体大小</p><p>cellStyle.setFont(font);</p><p>cell.setCellStyle(cellStyle);</p><p>}</p><p>/**</p><p>&nbsp;* 创建通用excel第二行</p><p>&nbsp;* @param params用来表示第二行中小标题内容的数组</p><p>&nbsp;*/</p><p>public void createNormalTwoRow(String[] params){</p><p>//创建第二行</p><p>HSSFRow row = sheet.createRow(1);</p><p>row.setHeight((short)400);</p><p>HSSFCell cell = row.createCell(0);</p><p>//cell.setCellType(HSSFCell.ENCODING_UTF_16);</p><p>cell.setCellValue(new HSSFRichTextString("" + ""));</p><p>//定义单元格格式，添加单元格样式表，并添加到工作簿</p><p>HSSFCellStyle cellStyle = wb.createCellStyle();</p><p>cellStyle.setAlignment(HorizontalAlignment.CENTER);//设置单元格水平居中</p><p>cellStyle.setVerticalAlignment(VerticalAlignment.CENTER);//设置单元格垂直居中</p><p>cellStyle.setWrapText(true);//设置单元格自动换行</p><p>//设置单元格字体</p><p>HSSFFont font = wb.createFont();</p><p>//font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);</p><p>font.setBold(true);</p><p>font.setFontName("宋体");</p><p>font.setFontHeight((short)250);</p><p>cell.setCellStyle(cellStyle);</p><p>for(int i = 0 ; i &lt; params.length ; i ++){</p><p>cell = row.createCell(i);</p><p>cell.setCellValue(params[i]);</p><p>}</p><p>}</p><p>/**</p><p>&nbsp;* 设置工作表列宽</p><p>&nbsp;* @param arg每列宽度</p><p>&nbsp;*/</p><p>public void setSheetColumnWidth(int arg[]) throws Exception{</p><p>for(int i = 0 ;i &lt; arg.length; i ++ ){</p><p>//设置工作表列宽</p><p>sheet.setColumnWidth(i, arg[i]);</p><p>}</p><p>}</p><p>/**</p><p>&nbsp;* 设置excel标题</p><p>&nbsp;* @param columHeader标题字符串数组</p><p>&nbsp;*/</p><p>public void createColumHeader(String[] columHeader){</p><p>//设置列头，在第三行</p><p>HSSFRow row = sheet.createRow(2);</p><p>//指定行高</p><p>row.setHeight((short)600);</p><p>//设置单元格格式，添加单元格样式，并添加到工作簿</p><p>HSSFCellStyle cellStyle = wb.createCellStyle();</p><p>cellStyle.setAlignment(HorizontalAlignment.CENTER);//设置单元格水平居中HSSFCellStyle.ALIGN_CENTER</p><p>cellStyle.setVerticalAlignment(VerticalAlignment.CENTER);//设置单元格垂直居中HSSFCellStyle.VERTICAL_CENTER</p><p>cellStyle.setWrapText(true);//设置单元格自动换行</p><p>//单元格字体</p><p>HSSFFont font = wb.createFont();</p><p>//font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);//设置字体加粗</p><p>font.setBold(true);</p><p>font.setFontName("宋体");//设置字体格式</p><p>font.setFontHeight((short)250);</p><p>cellStyle.setFont(font);</p><p>//设置单元格背景色</p><p>cellStyle.setFillBackgroundColor(HSSFColor.GREY_25_PERCENT.index);//HSSFColor.HSSFColorPredefined.GREY_25_PERCENT.getIndex()</p><p>cellStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</p><p>HSSFCell cell = null;</p><p>//从第二行开头开始创建单元格，并给每一个单元格赋值</p><p>for(int item = 0 ; item &lt; columHeader.length; item ++){</p><p>cell = row.createCell(item);</p><p>//cell.setCellType(HSSFCell.ENCODING_UTF_16);</p><p>cell.setCellStyle(cellStyle);</p><p>cell.setCellValue(new HSSFRichTextString(columHeader[item]));</p><p>}</p><p>}</p><p>private HSSFCellStyle _headStyle = null;</p><p>public HSSFCellStyle getHeadStyle()</p><p>{</p><p>if(_headStyle==null)</p><p>{</p><p>_headStyle = wb.createCellStyle();</p><p>_headStyle.setAlignment(HorizontalAlignment.CENTER);//设置单元格水平居中</p><p>_headStyle.setVerticalAlignment(VerticalAlignment.CENTER);//设置单元格垂直居中</p><p>_headStyle.setFillForegroundColor(HSSFColor.GREEN.index);</p><p>_headStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</p><p>_headStyle.setBorderBottom(BorderStyle.THIN);</p><p>_headStyle.setBorderTop(BorderStyle.THIN);</p><p>_headStyle.setBorderRight(BorderStyle.THIN);</p><p>_headStyle.setBorderLeft(BorderStyle.THIN);</p><p>}</p><p>return _headStyle;</p><p>}</p><p>private HSSFCellStyle _contentStyle = null;</p><p>public HSSFCellStyle getContentStyle()</p><p>{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if(_contentStyle==null)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle = wb.createCellStyle();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle.setAlignment(HorizontalAlignment.LEFT);//设置单元格水平居中HSSFCellStyle.ALIGN_LEFT</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle.setVerticalAlignment(VerticalAlignment.CENTER);//设置单元格垂直居中&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle.setBorderBottom(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle.setBorderTop(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle.setBorderRight(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _contentStyle.setBorderLeft(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>return _contentStyle;</p><p>}</p><p>private HSSFCellStyle _intStyle = null;</p><p>public HSSFCellStyle getIntegerStyle()</p><p>{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if(_intStyle==null)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _intStyle = wb.createCellStyle();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; //_intStyle.setAlignment(HorizontalAlignment.LEFT);//设置单元格水平居中HSSFCellStyle.ALIGN_LEFT</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _intStyle.setVerticalAlignment(VerticalAlignment.CENTER);//设置单元格垂直居中&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _intStyle.setBorderBottom(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _intStyle.setBorderTop(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _intStyle.setBorderRight(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _intStyle.setBorderLeft(BorderStyle.THIN);</p><p>// &nbsp; &nbsp;DataFormat format = wb.createDataFormat();</p><p>&nbsp; &nbsp; _intStyle.setDataFormat(HSSFDataFormat.getBuiltinFormat("0"));//#,##format.getFormat("0")</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>return _intStyle;</p><p>}</p><p>/**</p><p>&nbsp;* 创建内容单元格</p><p>&nbsp;* @param wbHSSFWorkbook</p><p>&nbsp;* @param rowHSSFRow</p><p>&nbsp;* @param colshort型的列索引</p><p>&nbsp;* @param align对齐方式</p><p>&nbsp;* @param val列值</p><p>&nbsp;*/</p><p>public void createCell(HSSFWorkbook wb,HSSFRow row,int col,short align,Object val,boolean head,boolean isInteger){</p><p>//根据该行的第几列创建单元格</p><p>HSSFCell cell = row.createCell(col);</p><p>//设置单元格格式</p><p>//cell.setCellType(HSSFCell.ENCODING_UTF_16);</p><p>if(isInteger==false)</p><p>{</p><p>if(((String)val).equals("")){</p><p>&nbsp; &nbsp;cell.setCellType(CellType.BLANK);</p><p>}else {</p><p>&nbsp; &nbsp;cell.setCellValue(new HSSFRichTextString((String)val));//设置单元格值</p><p>}</p><p>}else{</p><p>cell.setCellValue((Integer)val);//设置单元格值</p><p>}</p><p>//设置单元格样式，添加样式到工作簿</p><p>HSSFCellStyle cellStyle = isInteger?getIntegerStyle():(head?getHeadStyle():getContentStyle());</p><p>cell.setCellStyle(cellStyle);</p><p>}</p><p>public void createEmptyCell(HSSFWorkbook wb,HSSFRow row,int col,short align,Object val,boolean head,boolean isInteger){</p><p>//根据该行的第几列创建单元格</p><p>HSSFCell cell = row.createCell(col);</p><p>//设置单元格格式</p><p>//cell.setCellType(HSSFCell.ENCODING_UTF_16);</p><p>//设置单元格样式，添加样式到工作簿</p><p>HSSFCellStyle cellStyle = isInteger?getIntegerStyle():(head?getHeadStyle():getContentStyle());</p><p>cell.setCellStyle(cellStyle);</p><p>}</p><p>private HSSFCellStyle _dateStyle =null;</p><p>private SimpleDateFormat _datefmt = new SimpleDateFormat("yyyy/M/d");&nbsp;</p><p>public void createDateCell(HSSFWorkbook wb,HSSFRow row,int col,short align,Date val){</p><p>if(_dateStyle==null) {</p><p>_dateStyle = wb.createCellStyle();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; CreationHelper createHelper = wb.getCreationHelper();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _dateStyle.setDataFormat(createHelper.createDataFormat().getFormat("yyyy/m/d"));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _dateStyle.setBorderBottom(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _dateStyle.setBorderTop(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _dateStyle.setBorderRight(BorderStyle.THIN);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; _dateStyle.setBorderLeft(BorderStyle.THIN);</p><p>}</p><p>HSSFCell cell = row.createCell(col);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Calendar cal = Calendar.getInstance();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cal.setTime(val);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cal.set(Calendar.HOUR_OF_DAY, 0);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cal.set(Calendar.MINUTE, 0);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cal.set(Calendar.SECOND, 0);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cal.set(Calendar.MILLISECOND, 0);</p><p>cell.setCellValue(cal);</p><p>cell.setCellStyle(_dateStyle);</p><p>}</p><p>/**</p><p>&nbsp;* 创建合计行</p><p>&nbsp;* @param colSum需要合并到的列索引</p><p>&nbsp;* @param cellValue列值</p><p>&nbsp;*/</p><p>public void createLastSumRow(int colSum,String[] cellValue){</p><p>HSSFCellStyle cellStyle = wb.createCellStyle();</p><p>cellStyle.setAlignment(HorizontalAlignment.CENTER);//设置单元格水平居中</p><p>cellStyle.setVerticalAlignment(VerticalAlignment.CENTER);//设置单元格垂直居中</p><p>cellStyle.setWrapText(true);//设置单元格自动换行</p><p>//单元格字体</p><p>HSSFFont font = wb.createFont();</p><p>//font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);</p><p>font.setBold(true);</p><p>font.setFontName("宋体");</p><p>font.setFontHeight((short)250);</p><p>cellStyle.setFont(font);</p><p>//获取工作表最后一行</p><p>HSSFRow lastRow = sheet.createRow((short)(sheet.getLastRowNum() + 1));</p><p>HSSFCell sumCell = lastRow.createCell(0);</p><p>sumCell.setCellValue("合计");//设置单元格内容</p><p>sumCell.setCellStyle(cellStyle);</p><p>//合并 &nbsp;最后一行的第零列 至 最后一行的第一列</p><p>sheet.addMergedRegion(new CellRangeAddress(sheet.getLastRowNum(),sheet.getLastRowNum() - 1</p><p>,sheet.getLastRowNum(),colSum));</p><p>for(int item = 2 ; item &lt; (cellValue.length + 2) ; item++){</p><p>//定义最后一行的第三列</p><p>sumCell = lastRow.createCell(item);</p><p>sumCell.setCellStyle(cellStyle);</p><p>//定义数组，从0开始</p><p>sumCell.setCellValue(new HSSFRichTextString(cellValue[item - 2]));</p><p>}</p><p>}</p><p>/**</p><p>&nbsp;* 将数据输入到excel文件</p><p>&nbsp;* @param fileName文件名</p><p>&nbsp;*/</p><p>public void outputExcel(String fileName){</p><p>//定义文件输出流</p><p>FileOutputStream fos = null;</p><p>try{</p><p>File ofi = new File(fileName);</p><p>if(!ofi.exists())</p><p>{</p><p>ofi.createNewFile();</p><p>}</p><p>fos = new FileOutputStream(ofi);</p><p>wb.write(fos);//将数据写入文件中</p><p>}catch(Exception e){</p><p>e.printStackTrace();</p><p>}finally{</p><p>//防止资源的浪费，保证了即使出错也会回收资源</p><p>try{</p><p>fos.close();</p><p>}catch(Exception e2){</p><p>e2.printStackTrace();</p><p>}</p><p>}</p><p>}</p><p>public static HashSet&lt;String&gt; getQALinkUserList(String dateStr)</p><p>{</p><p>String start = dateStr + " 00:00:00";</p><p>String end = dateStr + " 23:59:59";</p><p>HashSet&lt;String&gt; res = new HashSet&lt;String&gt;();</p><p>try{</p><p>String sql = "SELECT sid from tbl_qa where time&gt;="+start+" AND time&lt;"+end;</p><p>ApplicationContext ac = SpringUtil.getApplicationContext();</p><p>UserDAOImpl dao = (UserDAOImpl)ac.getBean("userDao");</p><p>List&lt;HashMap&lt;String,String&gt;&gt; ret=dao.query(sql);</p><p>for(Iterator&lt;HashMap&lt;String,String&gt;&gt; &nbsp;it=ret.iterator();it.hasNext();){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HashMap&lt;String,String&gt; value = it.next();</p><p>String sid = value.get("sid");</p><p>if(sid!="null"/* &amp;&amp; !answer.equals("")*/)//TODO:Congirm null "null"</p><p>{</p><p>res.add(sid);</p><p>}</p><p>}</p><p>}catch(Exception e)</p><p>{</p><p>e.printStackTrace();</p><p>}</p><p>return res;</p><p>}</p><p>&nbsp; &nbsp; static class Detail {</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public long identification;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public String time;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public String uid;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public String question;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public String answer;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public String survey;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public int seq;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;public Detail(long identification,String time,String uid,String question,String answer,String survey,int seq)</p><p>&nbsp; &nbsp; &nbsp; &nbsp;{</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.identification = identification;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.time = time;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.uid = uid;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.question = question;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.answer = answer;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.survey = survey;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;this.seq = seq;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;}</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; private static boolean sameDate(Date d1, Date d2) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; LocalDate localDate1 = ZonedDateTime.ofInstant(d1.toInstant(), ZoneId.systemDefault()).toLocalDate();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; LocalDate localDate2 = ZonedDateTime.ofInstant(d2.toInstant(), ZoneId.systemDefault()).toLocalDate();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; return localDate1.isEqual(localDate2);</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; static Logger log4j = Logger.getLogger(ExportExcelUtils.class);</p><p>public static void genrateQALinkXls(String dateStr,String root)</p><p>{</p><p>ArrayList&lt;Detail&gt; res = new ArrayList&lt;Detail&gt;();</p><p>SimpleDateFormat fmt = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");</p><p>String[] str=dateStr.split("_");</p><p>if(str.length&lt;2)</p><p>{</p><p>return;</p><p>}</p><p>String start = str[0] + " 23:59:59";</p><p>String end = str[1] + " 23:59:59";</p><p>//long starttime = 0,endtime = 0;</p><p>try{</p><p>//starttime = fmt.parse(start).getTime();</p><p>//endtime = fmt.parse(end).getTime();</p><p>String sql = "SELECT time,sid,question,survey,seq from tbl_qa where time&gt;='"+start+"' AND time&lt;'"+end+"' order by sid,time";</p><p>ApplicationContext ac = SpringUtil.getApplicationContext();</p><p>UserDAOImpl dao = (UserDAOImpl)ac.getBean("userDao");</p><p>List&lt;HashMap&lt;String,String&gt;&gt; ret=dao.query(sql);</p><p>for(Iterator&lt;HashMap&lt;String,String&gt;&gt; &nbsp;it=ret.iterator();it.hasNext();){</p><p>HashMap&lt;String,String&gt; value = it.next();</p><p>//long identification = rs.getLong("identification");</p><p>String time = value.get("time");</p><p>String uid1 = value.get("sid");</p><p>String question = value.get("question");</p><p>//String answer = rs.getString("answer");</p><p>String survey = value.get("survey");</p><p>Integer seq = Integer.parseInt(value.get("seq"));</p><p>question = disTransformHtml(question);</p><p>if(uid1.length()&gt;2/* &amp;&amp; !answer.equals("")*/)</p><p>{</p><p>Detail child = new Detail(0,time,uid1,question,"",survey,seq);</p><p>res.add(child);</p><p>}</p><p>}</p><p>//rs.close();</p><p>}catch(Exception e){</p><p>log4j.info(e.getMessage());</p><p>}</p><p>ExportExcelUtils xls = null;</p><p>if(res.size()&gt;0)</p><p>{</p><p>xls = new ExportExcelUtils();</p><p>}</p><p>&nbsp; &nbsp; //xls.getSheet().setForceFormulaRecalculation(true);</p><p>//fmt = new SimpleDateFormat("yyyy-MM-dd");</p><p>fmt = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");</p><p>xls.getSheet().createRow(0);</p><p>xls.createCell(xls.getWb(), xls.getSheet().getRow(0), 0, (short)0, "域账号",true,false);</p><p>xls.createCell(xls.getWb(), xls.getSheet().getRow(0), 1, (short)0, "访问时间",true,false);</p><p>xls.createCell(xls.getWb(), xls.getSheet().getRow(0), 2, (short)0, "用户输入",true,false);</p><p>xls.createCell(xls.getWb(), xls.getSheet().getRow(0), 3, (short)0, "用户反馈",true,false);</p><p>xls.createCell(xls.getWb(), xls.getSheet().getRow(0), 4, (short)0, "访问次数",true,false);</p><p>xls.getSheet().setColumnWidth(0, 12*256);</p><p>xls.getSheet().setColumnWidth(1, 20*256);</p><p>xls.getSheet().setColumnWidth(2, 40*256);</p><p>xls.getSheet().setColumnWidth(3, 32*256);</p><p>xls.getSheet().setColumnWidth(4, 12*256);</p><p>// 同一个人按时间合并单元格 addMergedRegion</p><p>Date dStr = null,preDStr=null;</p><p>String preUid="";</p><p>int mergeStart = 1,mergeEnd = 1,rcount = res.size();</p><p>for(int i=0;i&lt;rcount;++i)</p><p>{</p><p>Detail child = res.get(i);</p><p>try {</p><p>&nbsp; &nbsp;dStr = fmt.parse(child.time);//((String)child.time).substring(0,10);//fmt.format(child.time);</p><p>}catch(Exception e) {</p><p>log4j.info(e.getMessage());</p><p>dStr = preDStr;</p><p>}</p><p>HSSFRow row = xls.getSheet().createRow(i+1);</p><p>xls.createCell(xls.getWb(), row, 0, (short)0, child.uid,false,false);</p><p>xls.createDateCell(xls.getWb(), row, 1, (short)0, dStr);</p><p>xls.createCell(xls.getWb(), row, 2, (short)0, child.question,false,false);</p><p>xls.createCell(xls.getWb(), row, 3, (short)0, child.survey,false,false);</p><p>xls.createCell(xls.getWb(), row, 4, (short)0, child.seq,false,true);//((child.seq==0)?1:child.seq)</p><p>if(!preUid.equals(child.uid) || !sameDate(preDStr,dStr) || i==rcount-1){</p><p>if(!preUid.equals(child.uid) || !sameDate(preDStr,dStr))</p><p>{</p><p>mergeEnd = i;</p><p>}else if(i==rcount-1){</p><p>mergeEnd = i+1;</p><p>}</p><p>preUid = child.uid;</p><p>preDStr = dStr;</p><p>//preSeq = child.seq;</p><p>if(i&gt;0 &amp;&amp; mergeEnd-mergeStart&gt;0)</p><p>{</p><p>&nbsp; // log4j.info("start="+mergeStart+",end="+mergeEnd);</p><p>&nbsp; &nbsp;for(int j=mergeStart+1;j&lt;=mergeEnd;++j)</p><p>&nbsp; &nbsp;{</p><p>&nbsp; &nbsp;HSSFCell ce = xls.getSheet().getRow(j).getCell(4);</p><p>&nbsp; &nbsp;ce.setCellType(CellType.BLANK);</p><p>&nbsp; &nbsp;//ce = xls.getSheet().getRow(j).getCell(1);</p><p>&nbsp; &nbsp;//ce.setCellType(CellType.BLANK);</p><p>&nbsp; &nbsp;//ce = xls.getSheet().getRow(j).getCell(0);</p><p>&nbsp; &nbsp;//ce.setCellType(CellType.BLANK);</p><p>&nbsp; &nbsp;}</p><p>&nbsp; &nbsp;</p><p>&nbsp; &nbsp;//xls.createCell(xls.getWb(), row, 0, (short)0, child.uid,false,false);</p><p>&nbsp; &nbsp;//xls.createCell(xls.getWb(), row, 1, (short)0, dStr,false,false);</p><p>&nbsp; &nbsp;//xls.createCell(xls.getWb(), row, 4, (short)0, preSeq,false,true);//((child.seq==0)?1:child.seq)</p><p>&nbsp; &nbsp;xls.getSheet().addMergedRegion(new CellRangeAddress(mergeStart,mergeEnd,0,0));</p><p>&nbsp; &nbsp;xls.getSheet().addMergedRegion(new CellRangeAddress(mergeStart,mergeEnd,1,1));</p><p>&nbsp; &nbsp;xls.getSheet().addMergedRegion(new CellRangeAddress(mergeStart,mergeEnd,4,4));</p><p>}</p><p>mergeStart = i+1;</p><p>mergeEnd = i+1;</p><p>}</p><p>}</p><p>if(xls!=null)</p><p>{</p><p>xls.outputExcel(root+"Report_"+dateStr+".xls");</p><p>}</p><p>}</p><p style="display:none;">//生成访问量xls
public static void genrateVisitXls(String dateStr,String xlsFilePath)
{
List&lt;HashMap</p>
    </div>
    
    
    <p class="pc_current ask-tip">登录后可下载附件，请<a href="https://auth.huaweicloud.com/authui/login?service=https://bbs.huaweicloud.com/blogs/110428#attachment&amp;locale=zh-cn">登录</a>或者<a href="https://reg.huaweicloud.com/registerui/public/custom/register.html?locale=zh-cn&amp;service=https://bbs.huaweicloud.com#/register">注册</a></p>

    <!-- 版权声明 start -->
    
   
    
    <!-- 版权声明 end -->

    <div class="blog-menu-footer m-blog-menu-footer-bottom">
        
    </div>
</div></div>