<link rel="stylesheet" type="text/css" href="../css/blog.css"><div class="cloud-blog-detail-content-wrap the_height"><div class="cloud-blog-detail-content-wrap">
    <div class="cloud-blog-detail-content blog-content-block-0" id="blogContent">
        <p style="white-space:normal;">spring 4 没有使用spring-boot，也不想退到spring3</p><p style="white-space:normal;">ldap manager的密码加密方案</p><p style="white-space:normal;">---继承DefaultSpringSecurityContextSource，然后在里面使用 jasypt解密，感觉可行</p><p style="white-space:normal;">---附件:jasypt工具</p><p style="white-space:normal;"><br></p><p style="white-space:normal;">参考文档:</p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/22067552/encryption-decrypt-using-jasypt">https://stackoverflow.com/questions/22067552/encryption-decrypt-using-jasypt</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://docs.spring.io/spring-security/site/docs/4.2.11.RELEASE/apidocs/org/springframework/security/ldap/DefaultSpringSecurityContextSource.html">https://docs.spring.io/spring-security/site/docs/4.2.11.RELEASE/apidocs/org/springframework/security/ldap/DefaultSpringSecurityContextSource.html</a></p><p style="white-space:normal;"><a rel="nofollow" href="http://www.sephiroth-j.de/java/spring-security-ltpa2/usage.html">http://www.sephiroth-j.de/java/spring-security-ltpa2/usage.html</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://github.com/spring-projects/spring-security-kerberos">https://github.com/spring-projects/spring-security-kerberos</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://github.com/spring-projects/spring-security-kerberos/blob/master/spring-security-kerberos-client/src/main/java/org/springframework/security/kerberos/client/ldap/KerberosLdapContextSource.java">https://github.com/spring-projects/spring-security-kerberos/blob/master/spring-security-kerberos-client/src/main/java/org/springframework/security/kerberos/client/ldap/KerberosLdapContextSource.java</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/html/ldap.html">https://docs.spring.io/spring-security/site/docs/4.0.x/reference/html/ldap.html</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://spring.io/guides/gs/authenticating-ldap/">https://spring.io/guides/gs/authenticating-ldap/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://memorynotfound.com/spring-security-spring-ldap-authentication-example/">https://memorynotfound.com/spring-security-spring-ldap-authentication-example/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/20149939/encrypting-a-password-within-a-spring-configuration-file">https://stackoverflow.com/questions/20149939/encrypting-a-password-within-a-spring-configuration-file</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/33952246/how-to-avoid-plain-text-ldap-password-in-spring-security">https://stackoverflow.com/questions/33952246/how-to-avoid-plain-text-ldap-password-in-spring-security</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://serverfault.com/questions/271872/hudson-how-to-manually-encode-the-ldap-managerpassword">https://serverfault.com/questions/271872/hudson-how-to-manually-encode-the-ldap-managerpassword</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://github.com/spring-projects/spring-security/blob/master/crypto/src/main/java/org/springframework/security/crypto/password/LdapShaPasswordEncoder.java">https://github.com/spring-projects/spring-security/blob/master/crypto/src/main/java/org/springframework/security/crypto/password/LdapShaPasswordEncoder.java</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://www.mkyong.com/spring-security/spring-security-password-hashing-example/">https://www.mkyong.com/spring-security/spring-security-password-hashing-example/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/52647983/spring-security-without-ldap-password">https://stackoverflow.com/questions/52647983/spring-security-without-ldap-password</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://blog.csdn.net/gdfsbingfeng/article/details/16886805">https://blog.csdn.net/gdfsbingfeng/article/details/16886805</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/32244500/jasypt-with-spring-4-0">https://stackoverflow.com/questions/32244500/jasypt-with-spring-4-0</a></p><p style="white-space:normal;"><a rel="nofollow" href="http://www.jasypt.org/springsecurity.html">http://www.jasypt.org/springsecurity.html</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://www.baeldung.com/spring-boot-jasypt">https://www.baeldung.com/spring-boot-jasypt</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/23235314/spring-4-javaconfig-for-jasypt-and-profile">https://stackoverflow.com/questions/23235314/spring-4-javaconfig-for-jasypt-and-profile</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://suryanarayanjena.wordpress.com/jasypt/">https://suryanarayanjena.wordpress.com/jasypt/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://monibu1548.github.io/2017/02/09/jasypt/">https://monibu1548.github.io/2017/02/09/jasypt/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://github.com/spring-projects/spring-security/blob/master/ldap/src/main/java/org/springframework/security/ldap/DefaultSpringSecurityContextSource.java">https://github.com/spring-projects/spring-security/blob/master/ldap/src/main/java/org/springframework/security/ldap/DefaultSpringSecurityContextSource.java</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://github.com/ulisesbocchio/jasypt-spring-boot/issues/58">https://github.com/ulisesbocchio/jasypt-spring-boot/issues/58</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://github.com/tfredrich/jasypt/issues/1">https://github.com/tfredrich/jasypt/issues/1</a></p><p style="white-space:normal;"><br></p><p style="white-space:normal;"><br></p><p style="white-space:normal;">spring 配置多auth</p><p style="white-space:normal;"><a rel="nofollow" href="https://www.programmergate.com/spring-boot-spring-security-oauth2/">https://www.programmergate.com/spring-boot-spring-security-oauth2/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://blog.csdn.net/li90hou/article/details/77851845">https://blog.csdn.net/li90hou/article/details/77851845</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://geeks18.com/spring-security-password-configurations/">https://geeks18.com/spring-security-password-configurations/</a></p><p style="white-space:normal;"><a rel="nofollow" href="http://www.giuseppeurso.eu/en/multiple-authentication-providers-in-spring-security/">http://www.giuseppeurso.eu/en/multiple-authentication-providers-in-spring-security/</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://coderanch.com/t/653951/frameworks/Spring-Boot-Security-Config-Multiple">https://coderanch.com/t/653951/frameworks/Spring-Boot-Security-Config-Multiple</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://blog.csdn.net/wei_ya_wen/article/details/8529000">https://blog.csdn.net/wei_ya_wen/article/details/8529000</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://guides.micronaut.io/micronaut-database-authentication-provider-groovy/guide/index.html">https://guides.micronaut.io/micronaut-database-authentication-provider-groovy/guide/index.html</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/25729008/using-both-ldap-and-db-authentication-with-spring-security">https://stackoverflow.com/questions/25729008/using-both-ldap-and-db-authentication-with-spring-security</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://stackoverflow.com/questions/22115493/pre-authentication-without-authorization-using-spring-security/25114782#25114782">https://stackoverflow.com/questions/22115493/pre-authentication-without-authorization-using-spring-security/25114782#25114782</a></p><p style="white-space:normal;"><a rel="nofollow" href="https://www.baeldung.com/spring-security-multiple-auth-providers">https://www.baeldung.com/spring-security-multiple-auth-providers</a></p><p><br></p><p>spring ldap配置</p><p>web.xml中添加</p><pre class="brush:xml;toolbar:false">&lt;context-param&gt;
&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
&lt;param-value&gt;/WEB-INF/spring/root-context.xml,&nbsp;/WEB-INF/spring/spring-security.xml&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</pre><p>spring-security.xml<br></p><pre class="brush:xml;toolbar:false">&lt;?xml&nbsp;version="1.0"&nbsp;encoding="UTF-8"?&gt;
&lt;beans&nbsp;xmlns="..."&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;注意要在&nbsp;web.xml&nbsp;中扫描此配置文件&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;读取错误提示属性文件，实现自定义提示。原文件位置&nbsp;spring-security-core-4.2.3.RELEASE.jar&nbsp;包中&nbsp;org/springframework/security/messages_zh_CN.properties&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可以将其内容拷贝到自定义的属性文件中，修改相关的提示信息，将&nbsp;basenames&nbsp;属性值指向自定义属性文件
&nbsp;&nbsp;&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;&lt;bean&nbsp;id="messageSource"&nbsp;class="org.springframework.context.support.ReloadableResourceBundleMessageSource"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="basenames"&nbsp;value="classpath:org/springframework/security/messages_zh_CN"&gt;&lt;/property&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;security="none"：对指定的&nbsp;URL&nbsp;放行，不拦截。如一些静态文件。另外放行登录&nbsp;URL&nbsp;避免拦截，造成无法登录&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:http&nbsp;security="none"&nbsp;pattern="/xxx/login"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:http&nbsp;security="none"&nbsp;pattern="/resources/**"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:http&nbsp;security="none"&nbsp;pattern="/**/*.js"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:http&nbsp;security="none"&nbsp;pattern="/**/*.jsx"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:http&nbsp;auto-config="false"&nbsp;use-expressions="true"&nbsp;access-decision-manager-ref=""&nbsp;entry-point-ref="authenticationEntryPoint"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:headers&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:frame-options
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;policy="SAMEORIGIN"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:headers&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;login-page：表示自定义登录页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;login-processing-url：表示登录时提交的地址
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;username-parameter：表示登录时用户名使用的是哪个参数
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;password-parameter：表示登录时密码使用的是哪个参数
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default-target-url：
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;默认情况下，在登录成功后会返回到原本受限制的页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果用户是直接请求登录页面，登录成功后默认情况下会跳转到当前应用的根路径，即欢迎页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default-target-url&nbsp;属性可以指定，用户直接访问登录页面并登陆成功后跳转的页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果想让用户不管是直接请求登录页面，还是通过&nbsp;Spring&nbsp;Security&nbsp;引导过来的，登录之后都跳转到指定的页面，可以使用&nbsp;always-use-default-target&nbsp;属性为&nbsp;true&nbsp;来达到这一效果
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication-success-handler-ref：
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对应一个&nbsp;AuthencticationSuccessHandler&nbsp;实现类的引用
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;登录认证成功后会调用指定&nbsp;AuthenticationSuccessHandler&nbsp;的&nbsp;onAuthenticationSuccess&nbsp;方法，在此方法中进行登陆成功后的处理
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此时&nbsp;default-target-url&nbsp;失效
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication-failure-url：
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定登录认证失败后跳转的页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;默认情况下登录失败后会返回登录页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;登录失败后跳转的页面，也需放行，否则又会被重定向到登录页面。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication-failure-handler-ref：
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对应一个用于处理认证失败的&nbsp;AuthenticationFailureHandler&nbsp;实现类。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定了该属性，Spring&nbsp;Security&nbsp;在认证失败后会调用指定&nbsp;AuthenticationFailureHandler&nbsp;的&nbsp;onAuthenticationFailure&nbsp;方法对认证失败进行处理
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此时&nbsp;authentication-failure-url&nbsp;属性将不再发生作用。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:form-login&nbsp;login-page="/xxx/login"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;login-processing-url="/xxx/employee-jsons/doLogin.action"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;username-parameter="username"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;password-parameter="password"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication-success-handler-ref="authenticationSuccessHandlerImpl"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication-failure-handler-ref="authenticationFailureHandlerImpl"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:logout&nbsp;logout-success-url="/xxx/login"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logout-url="/xxx/logout"&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalidate-session="true"&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete-cookies="JSESSIONID"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;设置访问所有的&nbsp;URL&nbsp;都必须登录&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:intercept-url&nbsp;pattern="/**"&nbsp;access="isAuthenticated()"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access="hasRole('ROLE_ADMIN')"：表示拥有&nbsp;ADMIN&nbsp;角色的用户可以访问，否则&nbsp;403。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hasRole('ROLE_ADMIN')&nbsp;为&nbsp;SpEL&nbsp;表达式，必须以&nbsp;ROLE_&nbsp;开头
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--security:intercept-url&nbsp;pattern="/user/**"&nbsp;access="hasRole('ROLE_0')"/&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;指定登陆认证成功后，用户访问未授权的&nbsp;URL&nbsp;将跳转的&nbsp;URL&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:access-denied-handler&nbsp;error-page="/error/403"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:session-management&nbsp;session-fixation-protection="none"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-sessions="1"：同一用户只能在一个浏览器登录，当尝试在其他浏览器登陆时将被拒绝
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error-if-maximum-exceeded="true"：当设置了此属性，尝试在其他浏览器登录时，则原会话将被终止，将在新窗口建立新会话
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:concurrency-control&nbsp;max-sessions="1"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:session-management&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:csrf&nbsp;disabled="true"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:http&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="authenticationEntryPoint"&nbsp;class="diary.security.ContinueEntryPoint"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;value="/xxx/login"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;认证成功后的处理类&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="authenticationSuccessHandlerImpl"&nbsp;class="diary.security.AuthenticationSuccessHandlerImpl"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;认证失败后的处理类&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="authenticationFailureHandlerImpl"&nbsp;class="diary.security.AuthenticationFailureHandlerImpl"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;登录认证&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:authentication-manager&nbsp;alias="authenticationManager"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;直接将用户名密码卸载配置文件中
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:authentication-provider&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:user-service&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:user&nbsp;name="user"&nbsp;password="user"&nbsp;authorities="ROLE_USER"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:user&nbsp;name="admin"&nbsp;password="admin"&nbsp;authorities="ROLE_USER,&nbsp;ROLE_ADMIN"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:user-service&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:authentication-provider&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:authentication-provider&nbsp;ref='ldapAuthProvider'/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;使用自定义的类对用户提交的密码进行加密操作，实现&nbsp;AuthenticationSuccessHandler&nbsp;接口&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--security:authentication-provider&nbsp;user-service-ref="userDetailsServiceImpl"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:password-encoder&nbsp;ref="myMessageDigestPasswordEncoder"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:authentication-provider&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:authentication-manager&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;bean&nbsp;id="myMessageDigestPasswordEncoder"&nbsp;class="diary.security.MyMessageDigestPasswordEncoder"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;name="algorithm"&nbsp;value="md5"/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--bean&nbsp;id="userDetailsServiceImpl"&nbsp;class="diary.security.UserDetailsServiceImpl"&gt;&lt;/bean&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="contextSource"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="org.springframework.security.ldap.DefaultSpringSecurityContextSource"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;value="ldap://pekad01-dc.domain.com:389/dc=china,dc=huawei,dc=com"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="userDn"&nbsp;value="xxxxxxx@domain.com"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="password"&nbsp;value="xxxxxxx"/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&lt;/bean&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="ldapAuthProvider"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="org.springframework.security.ldap.authentication.LdapAuthenticationProvider"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;class="org.springframework.security.ldap.authentication.BindAuthenticator"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;ref="contextSource"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="userDnPatterns"&gt;&lt;list&gt;&lt;value&gt;sAMAccountName={0}&lt;/value&gt;&lt;/list&gt;&lt;/property&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="userSearch"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="userSearch"&nbsp;class="org.springframework.security.ldap.search.FilterBasedLdapUserSearch"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;index="0"&nbsp;value=""/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;index="1"&nbsp;value="(sAMAccountName={0})"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;index="2"&nbsp;ref="contextSource"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/property&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/constructor-arg&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="diary.security.CustomLdapAuthoritiesPopulator"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/constructor-arg&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;constructor-arg&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;class="org.springframework.security.ldap.userdetails.DefaultLdapAuthoritiesPopulator"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;ref="contextSource"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;value="ou=groups"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="groupRoleAttribute"&nbsp;value="ou"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/constructor-arg&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&lt;/bean&gt;
&lt;bean&nbsp;&nbsp;id="ldapContextSource"&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="org.springframework.ldap.core.support.LdapContextSource"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="url"&nbsp;value="ldap://pekad01-dc.domain.com:389/dc=china,dc=huawei,dc=com"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="base"&nbsp;value=""&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="userDn"&nbsp;value="xxxxxxx@domain.com"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="password"&nbsp;value="xxxxxxx"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="referral"&nbsp;value="follow"&nbsp;/&gt;
&lt;/bean&gt;
&lt;bean&nbsp;&nbsp;&nbsp;id="ldapTemplate"&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="org.springframework.ldap.core.LdapTemplate"&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depends-on="ldapContextSource"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;index="0"&nbsp;ref="ldapContextSource"&nbsp;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="ignorePartialResultException"&nbsp;value="true"/&gt;
&lt;/bean&gt;
&lt;bean&nbsp;id="LdapService"&nbsp;class="org.angularstudy.spring.services.LdapService"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="ldapTemplate"&nbsp;ref="ldapTemplate"&nbsp;/&gt;
&lt;/bean&gt;
&lt;/beans&gt;</pre><p>AuthenticationFailureHandlerImpl.java//认证失败后的回调</p><pre class="brush:java;toolbar:false">public&nbsp;class&nbsp;AuthenticationFailureHandlerImpl&nbsp;implements&nbsp;AuthenticationFailureHandler{
@Override
public&nbsp;void&nbsp;onAuthenticationFailure(HttpServletRequest&nbsp;request,&nbsp;HttpServletResponse&nbsp;response,
org.springframework.security.core.AuthenticationException&nbsp;exception)&nbsp;throws&nbsp;IOException,&nbsp;ServletException&nbsp;{
&nbsp;&nbsp;&nbsp;//&nbsp;AuthenticationException&nbsp;存放着异常信息，获取出来，放到&nbsp;Request&nbsp;中，转发到登录页面。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute("error",&nbsp;exception.getMessage());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.getRequestDispatcher("/xxx/login").forward(request,&nbsp;response);
}
}</pre><p>AuthenticationSuccessHandlerImpl.java//认证成功后的回调</p><pre class="brush:java;toolbar:false">public&nbsp;class&nbsp;AuthenticationSuccessHandlerImpl&nbsp;implements&nbsp;AuthenticationSuccessHandler&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;@Resource
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;UserMapper&nbsp;userMapper;
&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onAuthenticationSuccess(HttpServletRequest&nbsp;request,&nbsp;HttpServletResponse&nbsp;response,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Authentication&nbsp;authentication)&nbsp;throws&nbsp;IOException,&nbsp;ServletException&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;UserDetails&nbsp;中存放着用户名等信息
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//UserDetails&nbsp;userDetails&nbsp;=&nbsp;(UserDetails)&nbsp;authentication.getPrincipal();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;获取该用户信息，根据自己的业务规则写
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//User&nbsp;user&nbsp;=&nbsp;this.userMapper.getUserByUserName(username);
&nbsp;&nbsp;&nbsp;&nbsp;List&lt;GrantedAuthority&gt;&nbsp;info&nbsp;=&nbsp;new&nbsp;ArrayList&lt;GrantedAuthority&gt;(((LdapUserDetailsImpl)authentication.getPrincipal()).getAuthorities());
&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;user&nbsp;=&nbsp;new&nbsp;User();
&nbsp;&nbsp;&nbsp;&nbsp;user.setMail(info.get(0).toString());
&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;if(info.size()&lt;7)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.setId(info.get(3).toString().hashCode());
&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.setId(Integer.parseInt(info.get(6).toString()));
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;将用户放到&nbsp;Session
&nbsp;&nbsp;&nbsp;&nbsp;//userMapper.insert(user);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.getSession().setAttribute("currUser",&nbsp;user);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;跳转到主页
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;redirect&nbsp;=&nbsp;request.getParameter("redirect");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(redirect.contains("/xxx/index.html"))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(request.getContextPath()&nbsp;+&nbsp;"/xxx/xxxHome.html#!/index");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;redirect&nbsp;=&nbsp;UriUtils.decode(redirect,&nbsp;"UTF-8");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(redirect);//request.getContextPath()&nbsp;+
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p>ContinueEntryPoint.java//保存认证前请求的链接 以便认证成功后跳转 （有一点#hashcode要在前端转义）</p><pre class="brush:java;toolbar:false">public&nbsp;class&nbsp;ContinueEntryPoint&nbsp;extends&nbsp;LoginUrlAuthenticationEntryPoint&nbsp;{
public&nbsp;ContinueEntryPoint(String&nbsp;loginFormUrl)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(loginFormUrl);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;determineUrlToUseForThisRequest(HttpServletRequest&nbsp;request,&nbsp;HttpServletResponse&nbsp;response,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;exception)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;continueParamValue="";
try&nbsp;{
continueParamValue&nbsp;=&nbsp;UriUtils.encode(buildHttpReturnUrlForRequest(request),"UTF-8");
}&nbsp;catch&nbsp;(UnsupportedEncodingException&nbsp;e)&nbsp;{
e.printStackTrace();
}//UrlUtils.buildRequestUrl
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;redirect&nbsp;=&nbsp;super.determineUrlToUseForThisRequest(request,&nbsp;response,&nbsp;exception);//
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;ret&nbsp;=&nbsp;UriComponentsBuilder.fromPath(redirect).queryParam("redirect",&nbsp;continueParamValue).toUriString();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;buildHttpReturnUrlForRequest(HttpServletRequest&nbsp;request)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RedirectUrlBuilder&nbsp;urlBuilder&nbsp;=&nbsp;new&nbsp;RedirectUrlBuilder();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;urlBuilder.setScheme("http");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;urlBuilder.setServerName(request.getServerName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;urlBuilder.getUrl();
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p>CustomLdapAuthoritiesPopulator.java//构造用户信息--这段代码有点挫</p><pre class="brush:java;toolbar:false">public&nbsp;class&nbsp;CustomLdapAuthoritiesPopulator&nbsp;implements&nbsp;LdapAuthoritiesPopulator&nbsp;{
&nbsp;&nbsp;&nbsp;@Resource
&nbsp;&nbsp;&nbsp;private&nbsp;UserMapper&nbsp;userMapper;
&nbsp;&nbsp;&nbsp;public&nbsp;Collection&lt;GrantedAuthority&gt;&nbsp;getGrantedAuthorities(&nbsp;DirContextOperations&nbsp;context,&nbsp;String&nbsp;username)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList&lt;GrantedAuthority&gt;&nbsp;list&nbsp;=&nbsp;new&nbsp;ArrayList&lt;GrantedAuthority&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;mail=context.getStringAttribute("mail")!=null?context.getStringAttribute("mail"):"nonemail";
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.add((new&nbsp;SimpleGrantedAuthority(mail)));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(id==null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;user&nbsp;=&nbsp;new&nbsp;User();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.setMail(mail);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;将用户放到&nbsp;Session
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userMapper.insert(user);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;=&nbsp;user.getId();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.add(new&nbsp;SimpleGrantedAuthority(String.valueOf(id)));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;list;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p>xxxcontroller.java//相关控制器</p><pre class="brush:java;toolbar:false">@RequestMapping(value="login"&nbsp;,&nbsp;method={&nbsp;RequestMethod.GET,&nbsp;RequestMethod.POST&nbsp;},&nbsp;name="login")
public&nbsp;String&nbsp;login(&nbsp;ModelMap&nbsp;model,HttpServletRequest&nbsp;request)&nbsp;throws&nbsp;Exception&nbsp;{
logger.info("params::::"&nbsp;+&nbsp;request.getRequestURI());
String&nbsp;redirect=request.getParameter("redirect");
model.addAttribute("redirect",&nbsp;redirect);
return&nbsp;"xxx/employee-jsons/login";
}
@RequestMapping(value="employee-jsons/logout.action"&nbsp;,&nbsp;method=RequestMethod.POST,&nbsp;name="logout")
@ResponseBody
public&nbsp;Map&lt;String,Object&gt;&nbsp;logout(&nbsp;HttpServletRequest&nbsp;request,&nbsp;HttpServletResponse&nbsp;response)&nbsp;throws&nbsp;Exception&nbsp;{
logger.info("params::::"&nbsp;+&nbsp;request.getRequestURI());
&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,Object&gt;&nbsp;ret&nbsp;=&nbsp;new&nbsp;HashMap&lt;String,Object&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;ret.put("ajaxResult","success");
&nbsp;&nbsp;&nbsp;&nbsp;Authentication&nbsp;auth&nbsp;=&nbsp;SecurityContextHolder.getContext().getAuthentication();
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(auth&nbsp;!=&nbsp;null){&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;SecurityContextLogoutHandler().logout(request,&nbsp;response,&nbsp;auth);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;
}</pre><p><br></p><p>spring同时配置db和ldap验证<br></p><p>spring-security.xml中添加过滤器</p><pre class="brush:xml;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:custom-filter&nbsp;ref="captchaAuthenticaionFilter"&nbsp;after="FORM_LOGIN_FILTER"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:authentication-manager&nbsp;id="authenticationManager"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:authentication-provider&nbsp;ref='ldapAuthProvider'/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:authentication-provider&nbsp;user-service-ref="clientDetailsUserDetailsService"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;security:password-encoder&nbsp;ref="myMessageDigestPasswordEncoder"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:authentication-provider&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security:authentication-manager&gt;
&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="captchaAuthenticaionFilter"&nbsp;class="diary.security.TwoFactorAuthenticationFilter"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="filterProcessesUrl"&nbsp;value="/rb/"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="authenticationManager"&nbsp;ref="authenticationManager"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="authenticationFailureHandler"&nbsp;ref="authenticationFailureHandlerImpl"&nbsp;/&gt;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="authenticationSuccessHandler"&nbsp;ref="authenticationSuccessHandlerImpl"&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&lt;/bean&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="clientDetailsUserDetailsService"&nbsp;class="diary.security.clientDetailsUserDetailsService"&nbsp;/&gt;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;id="myMessageDigestPasswordEncoder"&nbsp;class="diary.security.MyMessageDigestPasswordEncoder"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;constructor-arg&nbsp;name="algorithm"&nbsp;value="md5"/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;</pre><p>clientDetailsUserDetailsService.java</p><pre class="brush:java;toolbar:false">@Service
public&nbsp;class&nbsp;clientDetailsUserDetailsService&nbsp;implements&nbsp;UserDetailsService&nbsp;{
@Autowired
protected&nbsp;LdapService&nbsp;LdapService;
public&nbsp;UserDetails&nbsp;loadUserByUsername(String&nbsp;input)&nbsp;throws&nbsp;UsernameNotFoundException&nbsp;{&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;split&nbsp;=&nbsp;input.split(":");
&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;user&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;if(split.length&gt;=4)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;u&nbsp;=&nbsp;split[0];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;passwd&nbsp;=&nbsp;split[1];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;uid&nbsp;=&nbsp;split[2];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;uname&nbsp;=&nbsp;split[3];
&nbsp;&nbsp;&nbsp;&nbsp;UserDetails&nbsp;userDetails&nbsp;=&nbsp;null;&nbsp;
List&lt;Map&lt;String,Object&gt;&gt;&nbsp;info&nbsp;=&nbsp;null;
if(uid!=null&nbsp;&amp;&amp;&nbsp;!uid.isEmpty())&nbsp;{
info&nbsp;=&nbsp;LdapService.selectLdapUsersOri(uid);
}
if(info.size()&gt;0)&nbsp;{
user&nbsp;=&nbsp;new&nbsp;User();
String&nbsp;mail&nbsp;=&nbsp;info.get(0).get("mail").toString();
user.setMail(mail);
....
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.add((new&nbsp;SimpleGrantedAuthority(mail)));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;user.setAuthorities(list);
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;user;
}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;if(user&nbsp;==&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UsernameNotFoundException("Invalid&nbsp;username&nbsp;or&nbsp;corporate&nbsp;domain");
&nbsp;&nbsp;&nbsp;&nbsp;}
return&nbsp;null;&nbsp;
}
}</pre><p>TwoFactorAuthenticationFilter.java//我这块db验证的场景比较特殊 只有一个特定的账号信息放行</p><pre class="brush:java;toolbar:false">public&nbsp;class&nbsp;TwoFactorAuthenticationFilter&nbsp;extends&nbsp;UsernamePasswordAuthenticationFilter&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;obtainUsername(HttpServletRequest&nbsp;request)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;user&nbsp;=&nbsp;request.getParameter("user");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;passwd&nbsp;=&nbsp;request.getParameter("passwd");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;uid&nbsp;=&nbsp;xxx;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;uname&nbsp;=&nbsp;xxx;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;combinedUsername&nbsp;=&nbsp;user&nbsp;+&nbsp;":"&nbsp;+&nbsp;passwd&nbsp;+&nbsp;":"&nbsp;+&nbsp;uid&nbsp;+&nbsp;":"&nbsp;+&nbsp;uname;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute("username","...");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute("password","...");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;combinedUsername;
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p>MyMessageDigestPasswordEncoder.java</p><pre class="brush:java;toolbar:false">public&nbsp;class&nbsp;MyMessageDigestPasswordEncoder&nbsp;extends&nbsp;MessageDigestPasswordEncoder&nbsp;&nbsp;{
public&nbsp;MyMessageDigestPasswordEncoder(String&nbsp;algorithm)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(algorithm);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;@Override
public&nbsp;boolean&nbsp;isPasswordValid(String&nbsp;encPass,&nbsp;String&nbsp;rawPass,&nbsp;Object&nbsp;salt)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;if(StringUtils.isEmpty(rawPass))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;BadCredentialsException("密码不能为空");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;encPass.equals(rawPass);*/
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
&nbsp;}
}</pre><p><br></p>
    </div>
    
    <div class="cloud-blog-detail-attachment-download" id="attachment">
    
            <p>
                <img src="https://res.hc-cdn.com/ecology/6.7.104/editor/node_modules/tinymce/icons/fileassets/file_type_zip.svg">
                <a att-id="24374f4e605911e9bd5a7ca23e93a891" href="/blogs/attachment?id=24374f4e605911e9bd5a7ca23e93a891" title="nginx-1.14.2.zip">nginx-1.14.2.zip</a>
                <span class="attSize">1.41M</span>
                <span class="downloadNum">，下载次数：<i>1</i>次</span>
            </p>
    
            <p>
                <img src="https://res.hc-cdn.com/ecology/6.7.104/editor/node_modules/tinymce/icons/fileassets/file_type_zip.svg">
                <a att-id="4c280e36605111e9bd5a7ca23e93a891" href="/blogs/attachment?id=4c280e36605111e9bd5a7ca23e93a891" title="jasypt-1.9.2-dist.zip">jasypt-1.9.2-dist.zip</a>
                <span class="attSize">6.95M</span>
                <span class="downloadNum">，下载次数：<i>0</i>次</span>
            </p>
    
    </div>
    
    
    <p class="pc_current ask-tip">登录后可下载附件，请<a href="https://auth.huaweicloud.com/authui/login?service=https://bbs.huaweicloud.com/blogs/111643#attachment&amp;locale=zh-cn">登录</a>或者<a href="https://reg.huaweicloud.com/registerui/public/custom/register.html?locale=zh-cn&amp;service=https://bbs.huaweicloud.com#/register">注册</a></p>

    <!-- 版权声明 start -->
    
   
    
    <!-- 版权声明 end -->

    <div class="blog-menu-footer m-blog-menu-footer-bottom">
        
        <a class="common-blog-menu-btn title_banner_7" target="_self" rel="noopener noreferrer" mate_data_ts="bbs_blogdetail_blogTag.click.登录_Blog" title="登录" href="https://developer.huaweicloud.com/tags/200657/blog_1">登录</a>
        
        <a class="common-blog-menu-btn title_banner_7" target="_self" rel="noopener noreferrer" mate_data_ts="bbs_blogdetail_blogTag.click.Spring_Blog" title="Spring" href="https://developer.huaweicloud.com/tags/200680/blog_1">Spring</a>
        
    </div>
</div></div>