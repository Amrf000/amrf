<link rel="stylesheet" type="text/css" href="../css/blog.css"><div class="cloud-blog-detail-content-wrap the_height"><div class="cloud-blog-detail-content-wrap">
    <div class="cloud-blog-detail-content blog-content-block-0" id="blogContent">
        <p><br></p><p>What we are building — Screenshot<br></p><section><p class="graf graf--p graf-after--figure">Some time ago, I’ve decided to explore the vast abundance of software and services that the open source world offers. Purposefully, I used technologies I haven’t had too much hands-on experience before (such as Heroku, gh pages, java websockets, React). So if you want to learn about these and have 0 experience, worry not. This story is about the very positive outcome.</p><p class="graf graf--p graf-after--p">TLDR; — if you want to go straight to full code — <a rel="nofollow" href="http://---%20%20https//github.com/jasofalcon/chat-ws-java%20%20%20%20---" class="markup--anchor markup--p-anchor">backend</a>,&nbsp;<a rel="nofollow" href="https://github.com/jasofalcon/chat-ws-client" class="markup--anchor markup--p-anchor">frontend</a></p><p class="graf graf--p graf-after--p">We all know how interesting it is trying out something new, and seeing it succeed, and especially, how easy and elegant sometimes it is.</p><p class="graf graf--p graf-after--p graf--trailing">Let’s see…</p></section><section><hr><h3 class="graf graf--h3 graf--leading">Backend (Java):</h3><p class="graf graf--p graf-after--h3">As mentioned before, I wanted to make the whole cut-through from development to deployment, because I was a bit sick of all the articles only telling one part of the story. So I went with build tool. Being Java guy, it will most likely be Gradle or Maven, I chose the latter.</p><p class="graf graf--p graf-after--p">First, create a simple Maven project using Java (I used Java 8), and add java-websocket to your dependencies (<a rel="nofollow" href="https://mvnrepository.com/artifact/org.java-websocket/Java-WebSocket/1.3.0" class="markup--anchor markup--p-anchor"><strong class="markup--strong markup--p-strong">java-websocket</strong></a>). I’ve also used Jackson for marshalling/unmarshalling JSON as dependency and log4j for logging.</p><p class="graf graf--p graf-after--p">Second, create main class (I named it ChatServer) which will extend from&nbsp;<strong class="markup--strong markup--p-strong">WebSocketServer.&nbsp;</strong>In constructor, you will call&nbsp;<em class="markup--em markup--p-em">InetSocketAddress(port)</em>&nbsp;where ‘port’ is any port you wish to use for the communication (i.e.&nbsp;<strong class="markup--strong markup--p-strong">9000</strong>)</p><p class="graf graf--p graf-after--p">What’s important to do in this class is override few methods:</p><ul class="postList list-paddingleft-2"><li><p><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">onOpen</em>:&nbsp;</strong>when connection is received and established</p></li><li><p><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">onMessage</em></strong>: when message is received (you would probably want to broadcast message received to all other chat users)</p></li><li><p><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">replaceString</em></strong>: If something wrong happens</p></li><li><p><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">onClose</em>:&nbsp;</strong>…well, you get the idea&nbsp;:)</p></li></ul><p class="graf graf--p graf-after--li">The last thing you need to do is actually run the server.</p><pre class="graf graf--pre graf-after--p">new&nbsp;ChatServer(port).start();</pre><p class="graf graf--p graf-after--pre">It’s that simple.</p><p class="graf graf--p graf-after--p graf--trailing">See full code on:&nbsp;<a rel="nofollow" href="https://github.com/jasofalcon/chat-ws-java" class="markup--anchor markup--p-anchor">https://github.com/jasofalcon/chat-ws-java</a></p></section><section><hr><h3 class="graf graf--h3 graf--leading">Frontend (React):</h3><p class="graf graf--p graf-after--h3">I’ve mostly worked on comercial projects using Angular, so I wanted to explore React a bit, having in mind the vast usage around the globe. Turns out, it feels much more&nbsp;<em class="markup--em markup--p-em">lightweight</em>&nbsp;and&nbsp;<em class="markup--em markup--p-em">straight-forward&nbsp;</em>compared to Angular. At least on a first glance. I’ve also used&nbsp;<strong class="markup--strong markup--p-strong">Redux</strong>&nbsp;as I’ve noticed managing the state can be a bit cumbersome if app becomes even a bit more complex. But enough talk, let’s start. It’s a new kind of concept which works pretty well will React altogether.</p><p class="graf graf--p graf-after--p">First, you need to invest some time scaffolding the app. Or you can invest next to nothing using&nbsp;<a rel="nofollow" href="https://github.com/facebookincubator/create-react-app" class="markup--anchor markup--p-anchor">react-create-app</a>. So,</p><pre class="graf graf--pre graf-after--p">&gt;&nbsp;npm&nbsp;install&nbsp;-g&nbsp;create-react-app
&gt;&nbsp;create-react-app&nbsp;my-app
&gt;&nbsp;cd&nbsp;my-app
&gt;&nbsp;npm&nbsp;start</pre><p class="graf graf--p graf-after--pre">Now we have our app in place, running on localhost:3000</p><p class="graf graf--p graf-after--p">I will not go too deep into React workings, but you can imagine you will need few components.&nbsp;<em class="markup--em markup--p-em">UserList — </em>where we will display active users,&nbsp;<em class="markup--em markup--p-em">ChatHistory</em> — where we will show messages, and&nbsp;<em class="markup--em markup--p-em">SendMessage</em> — where we will write and send the messages.</p><p class="graf graf--p graf-after--p">Also, since I didn’t want to waste too much time CSS-ing and styling, I leveraged&nbsp;<a rel="nofollow" href="http://www.material-ui.com/#/" class="markup--anchor markup--p-anchor">material-ui</a>&nbsp;to quickly generate some fancy looking elements. It is integrated with React very easily and works smoothly.</p><p class="graf graf--p graf-after--p">For WebSockets, I haven’t used any external framework (but you could try socket.io) but a simple&nbsp;<a rel="nofollow" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" class="markup--anchor markup--p-anchor">WebSocket API</a>&nbsp;.</p><p class="graf graf--p graf-after--p">Working with web sockets on client side is even easier than backend. To open the connection with backend we created in Java, we just need to</p><pre class="graf graf--pre graf-after--p">let&nbsp;socket&nbsp;=&nbsp;new&nbsp;WebSocket(host);</pre><p class="graf graf--p graf-after--pre">where&nbsp;<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">host</em></strong><em class="markup--em markup--p-em">&nbsp;</em>is where your backend server is listening, in our example it would be:&nbsp;<strong class="markup--strong markup--p-strong">ws://localhost:9000</strong></p><p class="graf graf--p graf-after--p">Notice how we do not use http(s) protocol but ws (websocket) or wss (secured and recommended)</p><p class="graf graf--p graf-after--p">Once the connection is established, we can easily send a message like so:</p><pre class="graf graf--pre graf-after--p">//&nbsp;we&nbsp;have&nbsp;socket&nbsp;defined&nbsp;from&nbsp;lines&nbsp;above</pre><pre class="graf graf--pre graf-after--pre">payload&nbsp;=&nbsp;{user:&nbsp;"me",&nbsp;message:&nbsp;"hello&nbsp;sockets"};
socket.send(payload);</pre><p class="graf graf--p graf-after--pre">So far so good.</p><p class="graf graf--p graf-after--p">Now, since web sockets are used two ways communication (thus -&gt; chat), we also want to listen when backend broadcast some messages to us. To achieve this, we need to register some listeners.</p><pre class="graf graf--pre graf-after--p">//&nbsp;triggered&nbsp;when&nbsp;backend&nbsp;broadcasts&nbsp;a&nbsp;message
.onmessage&nbsp;=&nbsp;(message)&nbsp;=&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;handle&nbsp;message&nbsp;from&nbsp;backend
}</pre><pre class="graf graf--pre graf-after--pre">.onopen&nbsp;=&nbsp;()&nbsp;=&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;do&nbsp;something&nbsp;after&nbsp;connection&nbsp;is&nbsp;opened
}</pre><p class="graf graf--p graf-after--pre">If you are not familiar with ES6 and lambdas, it is same as writing following:</p><pre class="graf graf--pre graf-after--p">//&nbsp;triggered&nbsp;when&nbsp;backend&nbsp;broadcasts&nbsp;a&nbsp;message
socket.onmessage&nbsp;=&nbsp;function(message)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;handle&nbsp;message&nbsp;from&nbsp;backend
}</pre><p class="graf graf--p graf-after--pre">That’s all you need to know from perspective of websockets on frontend (for creating simple chat app, there’s more if you wish to build something more sophisticated)</p><p class="graf graf--p graf-after--p graf--trailing">See full code on:&nbsp;<a rel="nofollow" href="https://github.com/jasofalcon/chat-ws-client" class="markup--anchor markup--p-anchor">https://github.com/jasofalcon/chat-ws-client</a></p></section><section><hr><h3 class="graf graf--h3 graf--leading">Build &amp;&nbsp;Deploy</h3><p class="graf graf--p graf-after--h3">Now, since we used Maven for Java project, we can now easily build, package and run our app as jar. To do this locally, you will need&nbsp;<a rel="nofollow" href="https://maven.apache.org/install.html" class="markup--anchor markup--p-anchor">Maven</a>&nbsp;installed, after which you will just navigate to root of your java project and:</p><pre class="graf graf--pre graf-after--p">mvn&nbsp;clean&nbsp;package
java&nbsp;-jar&nbsp;target/[name-of-your-jar].jar</pre><p class="graf graf--p graf-after--pre">Voila. You have your backend app running. Now let’s run it on remote endpoint. You can use many different services such as AWS, MS Azure, Google Cloud, but there are very nice solutions which are completely free, one of the very famous ones which I used is&nbsp;<a rel="nofollow" href="https://dashboard.heroku.com/login" class="markup--anchor markup--p-anchor">heroku</a>. I propose you create account at once and start playing with it, there’s a very simple example on how to deploy your first example java app.</p><p class="graf graf--p graf-after--p">After you finished tutorial, you will understand how everything works and you will be deploying in no time. For my app, I had to dig a bit deeper to see how can I run it once it is published and I ran into two minor issues.</p><p class="graf graf--p graf-after--p">First one was packaging. I noticed after packing there was an issue with running my jar. The answer is pretty simple, you need to tell Maven to make a&nbsp;<em class="markup--em markup--p-em">fat-jar,&nbsp;</em>meaning, you want to have all your classes and all your dependencies in the jar, not only your project. So, in pom.xml file, add following:</p><pre class="graf graf--pre graf-after--p">&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;maven-assembly-plugin&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;your.package.ChatServer&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;jar-with-dependencies&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;make-assembly&lt;/&gt;&nbsp;&lt;&gt;package&lt;/&gt;&nbsp;&lt;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&gt;single&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/&gt;
&lt;/&gt;</pre><p class="graf graf--p graf-after--pre">The second question I had was&nbsp;<em class="markup--em markup--p-em">‘How will I tell heroku to run my jar?’&nbsp;.&nbsp;</em>Well, it turns out they provided a very easy solution to this. We only need to create a Procfile in our project root, and add something like so:</p><pre class="graf graf--pre graf-after--p">web:&nbsp;java&nbsp;-jar&nbsp;target/chat-1.0-SNAPSHOT-jar-with-dependencies.jar</pre><p class="graf graf--p graf-after--pre graf--trailing">Naturally, you will use your app name (I’ve just left it to be a SNAPSHOT for now..)</p></section><section><hr><p class="graf graf--p graf--leading">Now, when we have our backend up and running, only missing piece is to deploy our frontend app. We can also use many of existing web services, but why not use amazing&nbsp;<a rel="nofollow" href="https://pages.github.com/" class="markup--anchor markup--p-anchor">github pages</a>, since we already host our code, hopefully&nbsp;:)</p><p class="graf graf--p graf-after--p">To do this, easiest way I found is to install gh-pages. In a nutshell, a special branch will be created (gh-pages) which will be used to serve your ‘production-ready’ code.</p><p class="graf graf--p graf-after--p">Fortunately, there are tools already in place that we can use to do it in no time.</p><p class="graf graf--p graf-after--p">First, we will install gh pages ‘cli’, like so:</p><pre class="graf graf--pre graf-after--p">npm&nbsp;install&nbsp;--save&nbsp;gh-pages</pre><p class="graf graf--p graf-after--pre">Then, in your package.json, add the following:</p><pre class="graf graf--pre graf-after--p">"homepage":&nbsp;"https://your-user-name.github.io",</pre><p class="graf graf--p graf-after--pre">After this, we need to add two more lines under the ‘scripts’ section:</p><pre class="graf graf--pre graf-after--p">"predeploy":&nbsp;"npm&nbsp;run&nbsp;build",
"deploy":&nbsp;"gh-pages&nbsp;-d&nbsp;build"</pre><p class="graf graf--p graf-after--pre">and..</p><pre class="graf graf--pre graf-after--p">npm&nbsp;run&nbsp;deploy</pre><p class="graf graf--p graf-after--pre">Voila.</p><p class="graf graf--p graf-after--p">In a few moments you can visit your frontend app via:<br>https://<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">your-github-user</em></strong>.github.io/<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">your-repo-name</em></strong></p><p class="graf graf--p graf-after--p">That’s all folks! Again, to see the entire project visit:</p><ul class="postList list-paddingleft-2"><li><p>Frontend:&nbsp;<a rel="nofollow" href="https://github.com/jasofalcon/chat-ws-client" class="markup--anchor markup--li-anchor">https://github.com/jasofalcon/chat-ws-client</a></p></li><li><p>Backend:&nbsp;<a rel="nofollow" href="https://github.com/jasofalcon/chat-ws-java" class="markup--anchor markup--li-anchor">https://github.com/jasofalcon/chat-ws-java</a></p></li></ul></section><section><hr><h4 class="graf graf--h4 graf--leading">**Optional**</h4><p class="graf graf--p graf-after--h4 graf--trailing">If you wish, you can add one more step to your deployment process, that’s CI build. I would propose again free services like&nbsp;<a rel="nofollow" href="https://codeship.com/" class="markup--anchor markup--p-anchor">codeship</a>,&nbsp;<a rel="nofollow" href="https://travis-ci.org/" class="markup--anchor markup--p-anchor">travis</a>,&nbsp;<a rel="nofollow" href="http://circleci.com/" class="markup--anchor markup--p-anchor">circle-ci</a>. I’ve tried all three of those, and all are super-easy to setup and integrate with your github and deployment pipeline.</p></section><p><br></p><p><br></p><p><br></p><footer><ul class="tags tags--postTags tags--borderless list-paddingleft-2"><li><p><a rel="nofollow" class="link u-baseColor--link" href="https://medium.com/tag/react?source=post">React</a></p></li><li><p><a rel="nofollow" class="link u-baseColor--link" href="https://medium.com/tag/java8?source=post">Java8</a></p></li><li><p><a rel="nofollow" class="link u-baseColor--link" href="https://medium.com/tag/websocket?source=post">Websocket</a></p></li><li><p><a rel="nofollow" class="link u-baseColor--link" href="https://medium.com/tag/heroku?source=post">Heroku</a></p></li><li><p><a rel="nofollow" class="link u-baseColor--link" href="https://medium.com/tag/github-pages?source=post">Github Pages</a></p></li></ul></footer><p><br></p><p><br></p>
    </div>
    
    
    <p class="pc_current ask-tip">登录后可下载附件，请<a href="https://auth.huaweicloud.com/authui/login?service=https://bbs.huaweicloud.com/blogs/109304#attachment&amp;locale=zh-cn">登录</a>或者<a href="https://reg.huaweicloud.com/registerui/public/custom/register.html?locale=zh-cn&amp;service=https://bbs.huaweicloud.com#/register">注册</a></p>

    <!-- 版权声明 start -->
    
   
    
    <!-- 版权声明 end -->

    <div class="blog-menu-footer m-blog-menu-footer-bottom">
        
    </div>
</div></div>