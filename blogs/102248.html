<link rel="stylesheet" type="text/css" href="../css/blog.css"><div class="cloud-blog-detail-content-wrap the_height"><div class="cloud-blog-detail-content-wrap">
    <div class="cloud-blog-detail-content blog-content-block-0" id="blogContent">
        <p>原来的需求是模拟visio里面做出来的时间线的效果，所以我就做成了下面那种方案;这几天闲逛，看到别人做的不错的设计，我这里记下来；<img src="https://bbs-img.huaweicloud.com/blogs/img/1574144148745557.png" title="1574144148745557.png" alt="desgin1.png" width="545" height="281" class="localImage"></p><p>我初步看了一下前端代码绘制部分基于svg d3.js;</p><h3>下面我来说说我认为他的这种设计到底好在哪里,从用户视角:</h3><ul class="list-paddingleft-2" style="list-style-type:disc;"><li><p>采用明显的颜色来区分,已完成迭代，当前迭代，未开始迭代</p></li></ul><p>虽然我那个设计中也采用了颜色进行状态区分,但是线条小，视觉上不如这个明显;</p><ul class="list-paddingleft-2" style="list-style-type:disc;"><li><p>环形的进度显示相对于单纯的百分比数值显示更能聚焦人的注意力,</p></li><li><p>不仅记录进度还加入了相关的代码量和工作量记录,将用户可能关注的相关要素集中呈现,避免二次对照的过程;</p></li><li><p>当区段的长度相对小时,隐藏了代码量部分的显示，改成了鼠标浮动时显示完整信息;</p></li><li><p>鼠标浮动于当前时间点是，提示总体的一些进度和汇总信息;</p></li></ul><p><img src="https://bbs-img.huaweicloud.com/blogs/img/1574145745483023.png" title="1574145745483023.png" alt="desgin11.png" width="525" height="134" class="localImage"></p><ul class="list-paddingleft-2" style="list-style-type:disc;"><li><p>还可以注意到一些这样细节，同一段的的斜杠前后的字体大小或者颜色的变化的设计,都一样或者过于整齐的设计容易让人产生视觉疲劳;</p></li><li><p>其他的一些点,状态图的信息提示栏提供了更详细的描述信息;<br></p></li></ul><p><img src="https://bbs-img.huaweicloud.com/blogs/img/1574145909409117.png" title="1574145909409117.png" alt="desgin21.png" width="598" height="187" class="localImage"></p><ul class="list-paddingleft-2" style="list-style-type:disc;"><li><p>采用了更多的进度和趋势的图形辅助,更直观明了;</p></li></ul><p><img src="https://bbs-img.huaweicloud.com/blogs/img/1574145960638284.png" title="1574145960638284.png" alt="desgin3.png" class="localImage"></p><p><br></p><ul class="list-paddingleft-2" style="list-style-type:disc;"><li><p>还有一个我认为不错的特点，右上角的播放循环展板的功能;</p></li></ul><h3>看了一下这个项目的前端公共依赖：</h3><p>echarts.js</p><p>EventEmitter.min.js//EventEmitter v5.2.5</p><p>jquery-3.3.1.min.js//jQuery v3.3.1</p><p>jquery-ui.min.js//jQuery UI - v1.11.0</p><p>jquery.gridly.js//1.2.9</p><p>bootstrap.min.js//Bootstrap v3.3.7</p><p>Bootstrap: popover.js v3.2.0</p><p>Bootstrap: tooltip.js v3.2.0</p><p>bootstrap-slider.min.js//10.0.2&nbsp;</p><p>pnotify.js</p><p>bootstrap-table.js//1.12.1</p><p>jquery.dataTables.js//DataTables 1.10.4</p><p>dataTables.bootstrap.js</p><p>dataTables.rowsGroup.js//RowsGroup for DataTables v2.0.0</p><p>ColVis.min.js//1.0.8</p><p>DT_bootstrap.js</p><p>ckeditor.js//2003-2018</p><p>ckeditor/styles.js</p><p>ckeditor/lang/zh-cn.js</p><p>d3.js//3.2.8</p><p>jqPaginator.js</p><p>select2.min.js</p><p>bootstrap-multiselect.js//Bootstrap Multiselect v0.9.8</p><p>基本上是使用jquery+bootstrap的前端结构，并没有使用一些当前流行的前端框架，但是代码逻辑还是清晰的；</p><p><span style="color:rgb(0,176,80);">/*------------------------------------<span style="color:rgb(0,176,80);">--------</span>-----------------------------------------------------*/</span></p><h3><span style="color:rgb(0,0,0);">less教程</span></h3><p><span style="color:rgb(0,176,80);"><a rel="nofollow" href="https://www.ibm.com/developerworks/cn/web/1207_zhaoch_lesscss/">https://www.ibm.com/developerworks/cn/web/1207_zhaoch_lesscss/</a></span></p><h3>交互设计文档设计的一些查询记录</h3><p><a rel="nofollow" href="https://cloud.tencent.com/developer/article/1165820">https://cloud.tencent.com/developer/article/1165820</a> </p><p><a rel="nofollow" href="https://www.cnblogs.com/JoannaQ/p/3900463.html">https://www.cnblogs.com/JoannaQ/p/3900463.html</a></p><p><a rel="nofollow" href="https://www.ctolib.com/topics-36574.html">https://www.ctolib.com/topics-36574.html</a> </p><p><a rel="nofollow" href="https://zhuanlan.zhihu.com/p/21577848">https://zhuanlan.zhihu.com/p/21577848</a> </p><p><a rel="nofollow" href="http://www.yzsekj.com/cn_asp/m_newsview.asp%3Ftypeid%3D60%26id%3D83">http://www.yzsekj.com/cn_asp/m_newsview.asp%3Ftypeid%3D60%26id%3D83</a> </p><p><a rel="nofollow" href="https://wemp.app/posts/7b00dafd-a935-4c9a-a6cb-0bc0587ce6de">https://wemp.app/posts/7b00dafd-a935-4c9a-a6cb-0bc0587ce6de</a> </p><p><br></p><p><span style="color:rgb(0,176,80);">/*--------------------------------------------------------------------------------------------------*/</span></p><p><span style="color:rgb(0,176,80);">/*------------------------------------分割线-----------------------------------------------------*/</span></p><p><span style="color:rgb(0,176,80);"><span style="color:rgb(0,176,80);">/*------------------------------------<span style="color:rgb(0,176,80);">--------</span>-----------------------------------------------------*/</span></span></p><p><span style="color:rgb(0,0,0);">基于angularjs和mxgraph的里程碑计划控件</span></p><p>控件效果:</p><p><img src="https://bbs-img.huaweicloud.com/blogs/img/1564485262910490.png" title="1564485262910490.png" alt="p1.png" width="497" height="330" class="localImage"><img src="https://bbs-img.huaweicloud.com/blogs/img/1564485322856515.png" title="1564485322856515.png" alt="p2.png" width="475" height="315" class="localImage"></p><p><img src="https://bbs-img.huaweicloud.com/blogs/img/1564485328370488.png" title="1564485328370488.png" alt="p3.png" width="490" height="348" class="localImage">&nbsp;<img src="https://bbs-img.huaweicloud.com/blogs/img/1564485335537761.png" title="1564485335537761.png" alt="s3.png" width="481" height="348" class="localImage"></p><p>控件实现:</p><p>首先下载 :<a rel="nofollow" href="https://github.com/jgraph/mxgraph">https://github.com/jgraph/mxgraph</a>&nbsp;最新的版本</p><p>需要其中的mxgraph-master\javascript\examples\grapheditor\www目录中的所有和src中的mxClient.js文件，</p><h2>控件模板:</h2><pre class="brush:html;toolbar:false">&lt;head&gt;
&lt;meta&nbsp;charset="UTF-8"&gt;
&lt;link&nbsp;rel="stylesheet"&nbsp;type="text/css"&nbsp;href="/resources/mx/styles/grapheditor.css"&gt;
&lt;script&nbsp;type="text/javascript"&gt;
mxBasePath&nbsp;=&nbsp;'/resources/mx/';
STYLE_PATH&nbsp;=&nbsp;'/resources/mx/styles';
RESOURCES_PATH&nbsp;=&nbsp;'/resources/mx/resources';
STENCIL_PATH&nbsp;=&nbsp;'/resources/mx/stencils';
&lt;/script&gt;
&lt;!--mxGraph编辑器的相关js依赖--&gt;
&lt;script&nbsp;type="text/javascript"&gt;
var&nbsp;mile_ui&nbsp;=&nbsp;null;
function&nbsp;drawInit(xml){
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;editorUiInit&nbsp;=&nbsp;EditorUi.prototype.init;
&nbsp;&nbsp;&nbsp;&nbsp;EditorUi.prototype.init&nbsp;=&nbsp;function(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;};
mxResources.loadDefaultBundle&nbsp;=&nbsp;false;
var&nbsp;bundle&nbsp;=&nbsp;mxResources.getDefaultBundle(RESOURCE_BASE,&nbsp;mxLanguage)&nbsp;||
mxResources.getSpecialBundle(RESOURCE_BASE,&nbsp;mxLanguage);
mxUtils.getAll([bundle,&nbsp;STYLE_PATH&nbsp;+&nbsp;'/default.xml'],&nbsp;function(xhr)
{
....
//&nbsp;Main
mile_ui&nbsp;=&nbsp;new&nbsp;EditorUi(new&nbsp;Editor(urlParams['chrome']&nbsp;==&nbsp;'0',&nbsp;themes),document.getElementById('eContainer'));
updateDraw(xml);
//sco["htm"]=$('#eContainer').html();
},&nbsp;function()
{
....
});
}
function&nbsp;updateDraw(xml){
mile_ui.editor.graph.model.beginUpdate();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
var&nbsp;doc&nbsp;=&nbsp;mxUtils.parseXml(xml);
mile_ui.editor.graph.resizeContainer&nbsp;=&nbsp;true;
mile_ui.editor.setGraphXml(doc.documentElement);
mile_ui.editor.graph.centerZoom&nbsp;=&nbsp;false;
mile_ui.editor.graph.setTooltips(false);
mile_ui.editor.graph.setEnabled(false);
mile_ui.editor.graph.resizeContainer&nbsp;=&nbsp;false;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(e);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mile_ui.editor.graph.model.endUpdate();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
}
&lt;/script&gt;
&lt;/head&gt;
&lt;div&nbsp;class="mgt10&nbsp;mgb40&nbsp;pdl130&nbsp;pdr30&nbsp;position-relative"&gt;
&lt;table&nbsp;class="table&nbsp;table-bordered&nbsp;table-striped&nbsp;table-hover"&gt;
&lt;thead&gt;
&lt;tr&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;id="item"&nbsp;scope="colgroup"&gt;年&lt;/th&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;ng-repeat="year&nbsp;in&nbsp;RangeYear"&nbsp;id="y_{{year}}"&nbsp;scope="colgroup"&nbsp;colspan="12"&gt;{{year}}&lt;/th&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;scope="colgroup"&nbsp;rowspan="2"&nbsp;style="width:80px;"&gt;操作&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&nbsp;&nbsp;&nbsp;&lt;th&nbsp;scope="col"&nbsp;rowspan="1"&gt;月&lt;/th&gt;
&nbsp;&nbsp;&nbsp;&lt;th&nbsp;ng-repeat="month&nbsp;in&nbsp;RangeMonth&nbsp;&nbsp;track&nbsp;by&nbsp;$index"&nbsp;id="m_{{month}}"&gt;{{month}}&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&nbsp;
&lt;tbody&gt;
&lt;tr&nbsp;ng-repeat="tData&nbsp;in&nbsp;timelineData"&gt;
&lt;td&nbsp;scope="colgroup"&nbsp;style="height:{{ht/timelineData.length}}px"&gt;{{tData.title}}&lt;/td&gt;
&lt;td&nbsp;ng-if="$index==0"&nbsp;scope="colgroup"&nbsp;colspan="{{RangeYear.length*12}}"&nbsp;id="eContainer"&nbsp;style="height:{{ht}}px;padding:0;"&nbsp;rowspan="{{timelineData.length}}"&gt;&lt;/td&gt;
&lt;td&nbsp;scope="colgroup"&gt;
&lt;div&nbsp;class="pull-right&nbsp;pdt10&nbsp;mgb10"&nbsp;ng-click="addMileStone($event,$index)"&gt;
&lt;button&nbsp;class="btn&nbsp;btn-info&nbsp;btn-small&nbsp;ng-scope"&gt;
&lt;i&nbsp;class="icon-plus"&gt;&lt;/i&gt;
&lt;span&nbsp;class="ng-binding"&gt;添加&lt;/span&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;div&nbsp;class="pull-right&nbsp;pdt10&nbsp;mgb10"&nbsp;ng-click="updateMileStone($event,$index)"&gt;
&lt;button&nbsp;class="btn&nbsp;btn-success&nbsp;btn-small&nbsp;ng-scope"&gt;
&lt;i&nbsp;class="icon-refresh"&gt;&lt;/i&gt;
&lt;span&nbsp;class="ng-binding"&gt;更新&lt;/span&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;div&nbsp;class="pull-right&nbsp;pdt10&nbsp;mgb10"&nbsp;ng-click="showPlan($event,$index)"&gt;//这里要注意这里$index&nbsp;如果放到里面回合checkbox扩展的相关功能冲突，$index始终为用tdata为参数始终为第一个的问题
&lt;input&nbsp;type="checkbox"&nbsp;class="new-checkbox"&nbsp;id="showPlan"&nbsp;name="showPlan"&nbsp;ng-model="tData.showplan"/&gt;//同时写在外层也会有触发两次的问题使用preventdefeat处理
&lt;label&nbsp;for="showPlan"&gt;显示计划&lt;/label&gt;
&lt;/div&gt;
&lt;div&nbsp;class="pull-right&nbsp;pdt10&nbsp;mgb10"&nbsp;ng-click="showAct($event,$index)"&gt;&nbsp;
&lt;input&nbsp;type="checkbox"&nbsp;class="new-checkbox"&nbsp;id="showCt"&nbsp;name="showAct"&nbsp;ng-model="tData.showact"/&gt;
&lt;label&nbsp;for="showCt"&gt;显示实际&lt;/label&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div&nbsp;class="modal"&nbsp;id="addMileModal"&nbsp;tabindex="-1"&nbsp;role="dialog"&nbsp;aria-labelledby="myModalLabel"&nbsp;aria-hidden="true"&nbsp;data-backdrop="static"&gt;
....
&lt;/div&gt;
&lt;div&nbsp;class="modal"&nbsp;id="updateMileModal"&nbsp;tabindex="-1"&nbsp;role="dialog"&nbsp;aria-labelledby="myModalLabel"&nbsp;aria-hidden="true"&nbsp;data-backdrop="static"&gt;
.....
&lt;/div&gt;</pre><h2>控制器:</h2><pre class="brush:js;toolbar:false">angular.module('xxx.milestone',&nbsp;[]).component('mview',&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;controller:&nbsp;['$scope',&nbsp;'$http',&nbsp;'$window',&nbsp;'$stateParams',&nbsp;'$timeout','$compile',&nbsp;'xxxService',&nbsp;function($scope,&nbsp;$http,&nbsp;$window,&nbsp;$stateParams,&nbsp;$timeout,$compile,&nbsp;xxxService)&nbsp;{
var&nbsp;tid&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;oldtid&nbsp;=&nbsp;tid;
Object.defineProperty(this,&nbsp;'tid',&nbsp;{
get:&nbsp;function()&nbsp;{
&nbsp;&nbsp;return&nbsp;tid;
},
set:&nbsp;function(newVal)&nbsp;{
if(oldtid!=0&nbsp;&amp;&amp;&nbsp;oldtid&nbsp;==&nbsp;newVal){
return;
}
oldtid&nbsp;=&nbsp;newVal;
tid&nbsp;=&nbsp;newVal;
console.log('tid&nbsp;changed:',&nbsp;newVal);
$scope.timelineId&nbsp;=&nbsp;tid;
$scope.initData();
}
});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;contextpath&nbsp;=&nbsp;window.Ruban.contextPath;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeYear&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeMonth&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.timelineData&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.addMile&nbsp;=&nbsp;{};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.xml&nbsp;=&nbsp;"";
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.timelineId&nbsp;=&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.initDraw&nbsp;=&nbsp;false;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.ht&nbsp;=&nbsp;300;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.contentRestore&nbsp;=&nbsp;{};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.initData&nbsp;=&nbsp;function&nbsp;()&nbsp;{
var&nbsp;param&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"timelineId":&nbsp;$scope.timelineId
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.ht&nbsp;=&nbsp;$scope.timelineId.split(",").length&nbsp;*&nbsp;300;
var&nbsp;url&nbsp;=&nbsp;contextpath&nbsp;+&nbsp;'api/private/xxxx/getTimeline.json';
xxxService.commonPostJQlike(url,&nbsp;param,&nbsp;function&nbsp;(response)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!response.data.success){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.location.href=contextpath&nbsp;+"xxxHome.html#!/error";
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.timelineData&nbsp;=&nbsp;response.data.data;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.xml&nbsp;=&nbsp;response.data.xml;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;bgDate&nbsp;=&nbsp;new&nbsp;Date($scope.timelineData[0].bg);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;edDate&nbsp;=&nbsp;new&nbsp;Date($scope.timelineData[0].ed);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeYear&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeMonth&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var&nbsp;i&nbsp;=&nbsp;bgDate.getFullYear();i&nbsp;&lt;&nbsp;edDate.getFullYear();++i){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeYear.push(i);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var&nbsp;j=1;j&lt;=12;++j){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeMonth.push(j);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($scope.RangeMonth.indexOf(edDate.getFullYear())==-1){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeYear.push(edDate.getFullYear());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var&nbsp;j=1;j&lt;=12;++j){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.RangeMonth.push(j);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$timeout(function()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($scope.initDraw==false){//attan
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drawInit($scope.xml);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.initDraw&nbsp;=&nbsp;true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$('#eContainer').html($scope.contentRestore["htm"]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drawInit($scope.xml);//updateDraw--pro&nbsp;in&nbsp;this&nbsp;scene
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//这里不用updateDraw是因为当控件在ng-repeat中显示的时候，angularjs刷新子元素的一些过程导致开始的mxgraph绑定失效
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
$scope.addMileStone&nbsp;=&nbsp;function(e,cid)&nbsp;{
e.preventDefault();
$scope.currentStone&nbsp;=&nbsp;$scope.timelineData[cid];
$scope.addMile&nbsp;=&nbsp;{};
$("#addMileModal").modal();
};
$scope.submitMileAdd&nbsp;=&nbsp;function()&nbsp;{
$("#add_mile").attr("disabled",&nbsp;"disabled");
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;req&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;"timelineId":$scope.currentStone.id,
&nbsp;&nbsp;&nbsp;&nbsp;"addMile.planDesc":$scope.addMile.planDesc,
&nbsp;&nbsp;&nbsp;&nbsp;"addMile.planDate":$scope.addMile.planDate
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url=contextpath+"api/private/xxxxx/addMileView.json";
&nbsp;&nbsp;&nbsp;&nbsp;xxxService.commonPostJson(url,req,function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;});
};
$scope.updateMileStone&nbsp;=&nbsp;function(e,cid)&nbsp;{
e.preventDefault();
$scope.currentStone&nbsp;=&nbsp;$scope.timelineData[cid];
$timeout(function()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date();//用于刷新新增的日期控件功能
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$("#updateMileModal").modal();
};
$scope.submitMileUpdate&nbsp;=&nbsp;function()&nbsp;{
$("#update_mile").attr("disabled",&nbsp;"disabled");
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;req&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;"timelineId":$scope.currentStone.id,
&nbsp;&nbsp;&nbsp;&nbsp;"milestone":$scope.currentStone.milestone,
&nbsp;&nbsp;&nbsp;&nbsp;"title":$scope.currentStone.title
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url=contextpath+"api/private/xxxxx/updateMileView.json";
&nbsp;&nbsp;&nbsp;&nbsp;xxxService.commonPostJson(url,req,function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;});
};
$scope.showPlan&nbsp;&nbsp;=&nbsp;function(e,cid)&nbsp;{
e.preventDefault();
//console.log(cid);&nbsp;maybe&nbsp;syli&nbsp;double
$scope.currentStone&nbsp;=&nbsp;$scope.timelineData[cid];
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;req&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;"timelineId":$scope.currentStone.id,
&nbsp;&nbsp;&nbsp;&nbsp;"showplan":!$scope.currentStone.showplan
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url=contextpath+"api/private/xxxxx/updateMileView.json";
&nbsp;&nbsp;&nbsp;&nbsp;xxxService.commonPostJson(url,req,function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;});
};
$scope.showAct&nbsp;&nbsp;=&nbsp;function(e,cid)&nbsp;{
e.preventDefault();
$scope.currentStone&nbsp;=&nbsp;$scope.timelineData[cid];
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;req&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;"timelineId":$scope.currentStone.id,
&nbsp;&nbsp;&nbsp;&nbsp;"showact":!$scope.currentStone.showact
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url=contextpath+"api/private/xxxx/updateMileView.json";
&nbsp;&nbsp;&nbsp;&nbsp;xxxService.commonPostJson(url,req,function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;....
&nbsp;&nbsp;&nbsp;&nbsp;});
};
}],
&nbsp;&nbsp;&nbsp;&nbsp;controllerAs:&nbsp;'MilestoneController',
&nbsp;&nbsp;&nbsp;&nbsp;templateUrl:&nbsp;window.Ruban.contextPath+'pages/xxxx/milestone.html',
&nbsp;&nbsp;&nbsp;&nbsp;bindings:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tid:&nbsp;'@'
&nbsp;&nbsp;&nbsp;&nbsp;}
});</pre><h2>使用形式：</h2><pre class="brush:html;toolbar:false">&lt;div&nbsp;class="bgWhite"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;mview&nbsp;tid="${timelineId}"&gt;&lt;/mview&gt;//timelineId来自springcontrol绑定形式为以，分割的timelineId
&lt;/div&gt;</pre><h2>后端的一些实现：</h2><p>主要是使用dom4j写了一个MxGraphService的类来对显示到前端的mxgraph绘制对应的xml文件，</p><p>public static String formatXmlByInfo(List&lt;Map&lt;String,Object&gt;&gt; drawParam)；</p><p>//说明根据数据库中由timelineId查询到对应的里程碑信息来请求格式化绘图xml节点信息</p><p>public static List&lt;Node&gt; formatMileLine(int id[],int y)；</p><p>//id 为用来递增为绘图图元的id，该函数用来格式化返回最基本的中间的时间线</p><p>public static List&lt;Node&gt; formatToday(int id[],int x,int y,int parent)；</p><p>//返回指示当前日期的位置图元</p><p>public static List&lt;Node&gt; formatMilestone(int id[],int x,int y,Map&lt;String,Object&gt; info,String color,int parent)；</p><p>//返回计划里程碑图元</p><p>public static List&lt;Node&gt; formatMilestoneD(int id[],int x,int y,Map&lt;String,Object&gt; info,String color,int parent)；</p><p>//返回实际完成时间点图元</p><p>说明：上面的格式化过程其实很简单，具体是解析参数化过后的样本结构xml获得相应的xml节点返回，注意返回的xml Node需要clone以便添加到最终的根节点；</p><p><br></p><p><br></p>
    </div>
    
    
    <p class="pc_current ask-tip">登录后可下载附件，请<a href="https://auth.huaweicloud.com/authui/login?service=https://bbs.huaweicloud.com/blogs/102248#attachment&amp;locale=zh-cn">登录</a>或者<a href="https://reg.huaweicloud.com/registerui/public/custom/register.html?locale=zh-cn&amp;service=https://bbs.huaweicloud.com#/register">注册</a></p>

    <!-- 版权声明 start -->
    
   
    
    <!-- 版权声明 end -->

    <div class="blog-menu-footer m-blog-menu-footer-bottom">
        
    </div>
</div></div>